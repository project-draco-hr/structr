{
  logger.log(Level.FINE,"Creating service ",serviceClass.getName());
  Service service=null;
  try {
    service=(Service)serviceClass.newInstance();
    service.initialize(this,getCurrentConfig());
    if (service instanceof RunnableService) {
      RunnableService runnableService=(RunnableService)service;
      if (runnableService.runOnStartup()) {
        logger.log(Level.FINER,"Starting RunnableService instance ",serviceClass.getName());
        runnableService.startService();
        serviceCache.put(serviceClass,service);
      }
    }
 else     if (service instanceof SingletonService) {
      serviceCache.put(serviceClass,service);
    }
  }
 catch (  Throwable t) {
    if (service.isVital()) {
      logger.log(Level.SEVERE,t,LogMessageSupplier.create("Vital service {0} failed to start. Aborting",service.getClass().getSimpleName()));
      System.exit(1);
    }
 else {
      logger.log(Level.SEVERE,t,LogMessageSupplier.create("Service {0} failed to start",service.getClass().getSimpleName()));
    }
  }
  return service;
}
