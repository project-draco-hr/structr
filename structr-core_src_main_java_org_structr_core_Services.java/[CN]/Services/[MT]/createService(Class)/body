{
  logger.log(Level.FINE,"Creating service ",serviceClass.getName());
  Service service=null;
  try {
    service=(Service)serviceClass.newInstance();
    service.initialize(getCurrentConfig());
    if (service instanceof RunnableService) {
      RunnableService runnableService=(RunnableService)service;
      if (runnableService.runOnStartup()) {
        logger.log(Level.FINER,"Starting RunnableService instance ",serviceClass.getName());
        runnableService.startService();
        serviceCache.put(serviceClass,service);
      }
    }
 else     if (service instanceof SingletonService) {
      serviceCache.put(serviceClass,service);
    }
  }
 catch (  Throwable t) {
    if (service.isVital()) {
      logger.log(Level.SEVERE,"Vital service {0} failed to start: {1}. Aborting",new Object[]{service.getClass().getSimpleName(),t.getMessage()});
      System.exit(1);
    }
 else {
      logger.log(Level.SEVERE,"Service {0} failed to start: {1}.",new Object[]{service.getClass().getSimpleName(),t.getMessage()});
    }
  }
  return service;
}
