{
  GraphDatabaseService graphDb=(GraphDatabaseService)arguments.get("graphDb");
  RelationshipFactory relFactory=new RelationshipFactory(securityContext);
  NodeFactory nodeFactory=new NodeFactory(securityContext);
  List<GraphObject> resultList=new LinkedList<>();
  Result result=null;
  if (parameters != null) {
    result=graphDb.execute(query,parameters);
  }
 else {
    result=graphDb.execute(query);
  }
  while (result.hasNext()) {
    final Map<String,Object> row=result.next();
    GraphObjectMap dummyObject=null;
    for (    Entry<String,Object> entry : row.entrySet()) {
      String key=entry.getKey();
      Object value=entry.getValue();
      if (value instanceof Node) {
        NodeInterface node=nodeFactory.instantiate((Node)value,includeHiddenAndDeleted,publicOnly);
        if (node != null) {
          resultList.add(node);
        }
      }
 else       if (value instanceof Relationship) {
        RelationshipInterface rel=relFactory.instantiate((Relationship)value);
        if (rel != null) {
          resultList.add(rel);
        }
      }
 else {
        if (dummyObject == null) {
          dummyObject=new GraphObjectMap();
          resultList.add(dummyObject);
        }
        dummyObject.setProperty(new GenericProperty(key),value);
      }
    }
  }
  return resultList;
}
