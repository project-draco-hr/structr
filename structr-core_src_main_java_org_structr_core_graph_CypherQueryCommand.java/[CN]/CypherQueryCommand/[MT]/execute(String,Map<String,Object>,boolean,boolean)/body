{
  RelationshipFactory relFactory=(RelationshipFactory)arguments.get("relationshipFactory");
  ExecutionEngine engine=(ExecutionEngine)arguments.get("cypherExecutionEngine");
  NodeFactory nodeFactory=new NodeFactory(securityContext);
  List<GraphObject> resultList=new LinkedList<GraphObject>();
  ExecutionResult result=null;
  if (parameters != null) {
    result=engine.execute(query,parameters);
  }
 else {
    result=engine.execute(query);
  }
  for (  Map<String,Object> row : result) {
    GraphObjectMap dummyObject=null;
    for (    Entry<String,Object> entry : row.entrySet()) {
      String key=entry.getKey();
      Object value=entry.getValue();
      if (value instanceof Node) {
        AbstractNode node=nodeFactory.instantiateNode((Node)value,includeHiddenAndDeleted,publicOnly);
        if (node != null) {
          resultList.add(node);
        }
      }
 else       if (value instanceof Relationship) {
        AbstractRelationship rel=relFactory.instantiateRelationship(securityContext,(Relationship)value);
        if (rel != null) {
          resultList.add(rel);
        }
      }
 else {
        if (dummyObject == null) {
          dummyObject=new GraphObjectMap();
          resultList.add(dummyObject);
        }
        dummyObject.setProperty(new GenericProperty(key),value);
      }
    }
  }
  return resultList;
}
