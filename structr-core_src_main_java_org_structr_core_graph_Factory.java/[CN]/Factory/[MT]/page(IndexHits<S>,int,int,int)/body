{
  final List<T> nodes=new LinkedList<>();
  int position=0;
  int count=0;
  int overallCount=0;
  boolean pageFull=false;
  SecurityContext securityContext=factoryProfile.getSecurityContext();
  boolean dontCheckCount=securityContext.isSuperUser() || securityContext.getUser(false) == null;
  try (final IndexHits<S> closeable=input){
    for (    S node : closeable) {
      T n=instantiate(node);
      if (n != null) {
        overallCount++;
        if (++position > offset) {
          if (++count > pageSize) {
            pageFull=true;
            if (dontCheckCount) {
              overallCount=overallResultCount;
              break;
            }
          }
          if (!pageFull) {
            nodes.add(n);
          }
          if (pageFull && (overallCount >= RESULT_COUNT_ACCURATE_LIMIT)) {
            return new Result(nodes,overallResultCount,true,false);
          }
        }
      }
    }
  }
   return new Result(nodes,overallCount,true,false);
}
