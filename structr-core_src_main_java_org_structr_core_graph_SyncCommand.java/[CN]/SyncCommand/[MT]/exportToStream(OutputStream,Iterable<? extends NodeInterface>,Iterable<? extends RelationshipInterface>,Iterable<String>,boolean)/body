{
  try {
    Set<String> filesToInclude=new LinkedHashSet<String>();
    ZipOutputStream zos=new ZipOutputStream(outputStream);
    PrintWriter writer=new PrintWriter(new BufferedWriter(new OutputStreamWriter(zos)));
    if (filePaths != null) {
      for (      String file : filePaths) {
        filesToInclude.add(file);
      }
    }
    zos.setLevel(6);
    if (includeFiles) {
      exportDirectory(zos,new File("files"),"",filesToInclude.isEmpty() ? null : filesToInclude);
    }
    exportDatabase(zos,writer,nodes,relationships);
    zos.finish();
    writer.close();
  }
 catch (  Throwable t) {
    t.printStackTrace();
    throw new FrameworkException(500,t.getMessage());
  }
}
