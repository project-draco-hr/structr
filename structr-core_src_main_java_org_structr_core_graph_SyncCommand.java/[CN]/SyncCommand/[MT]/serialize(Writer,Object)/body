{
  if (obj != null) {
    Class clazz=obj.getClass();
    String type=typeMap.get(clazz);
    if (type != null) {
      if (clazz.isArray()) {
        Object[] array=(Object[])obj;
        int len=array.length;
        int log=Integer.toString(len).length();
        writer.append(type);
        writer.append(Integer.toString(log));
        writer.append(Integer.toString(len));
        for (        Object o : (Object[])obj) {
          serialize(writer,o);
        }
      }
 else {
        String str=obj.toString();
        int len=str.length();
        int log=Integer.toString(len).length();
        writer.append(type);
        writer.append(Integer.toString(log));
        writer.append(Integer.toString(len));
        writer.append(str);
      }
      writer.append(" ");
    }
 else {
      logger.log(Level.WARNING,"Unable to serialize object of type {0}, type not supported",obj.getClass());
    }
  }
 else {
    writer.append("000 ");
  }
  writer.flush();
}
