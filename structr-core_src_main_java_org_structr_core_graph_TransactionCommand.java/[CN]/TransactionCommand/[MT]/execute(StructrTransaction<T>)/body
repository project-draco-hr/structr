{
  boolean topLevel=(transactions.get() == null);
  boolean retry=true;
  int retryCount=0;
  if (topLevel) {
    T result=null;
    while (retry && retryCount++ < 100) {
      retry=false;
      try {
        result=executeInternal(transaction);
      }
 catch (      RetryException rex) {
        logger.log(Level.INFO,"Deadlock encountered, retrying transaction, count {0}",retryCount);
        retry=true;
      }
    }
    return result;
  }
 else {
    return executeInternal(transaction);
  }
}
