{
  if (arrayHasLengthAndAllElementsNotNull(sources,2)) {
    try {
      int maxLength=Double.valueOf(sources[1].toString()).intValue();
      if (sources[0].toString().length() > maxLength) {
        return StringUtils.substringBeforeLast(StringUtils.substring(sources[0].toString(),0,maxLength)," ").concat("???");
      }
 else {
        return sources[0];
      }
    }
 catch (    NumberFormatException nfe) {
      logException(entity,nfe,sources);
      return nfe.getMessage();
    }
  }
 else {
    logParameterError(entity,sources,ctx.isJavaScriptContext());
  }
  return "";
}
