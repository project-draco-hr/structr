{
  final PropertyConverter converter=databaseConverter(securityContext,obj);
  final Object convertedValue;
  if (converter != null) {
    convertedValue=converter.convert(value);
  }
 else {
    convertedValue=value;
  }
  final PropertyContainer propertyContainer=obj.getPropertyContainer();
  if (propertyContainer != null) {
    if (!TransactionCommand.inTransaction()) {
      logger.log(Level.SEVERE,"setProperty outside of transaction");
      throw new FrameworkException(500,"setProperty outside of transaction.");
    }
    if (!unvalidated) {
      if (obj instanceof AbstractNode) {
        TransactionCommand.nodeModified(securityContext.getCachedUser(),(AbstractNode)obj,AbstractPrimitiveProperty.this,propertyContainer.hasProperty(dbName()) ? propertyContainer.getProperty(dbName()) : null,value);
      }
 else       if (obj instanceof AbstractRelationship) {
        TransactionCommand.relationshipModified(securityContext.getCachedUser(),(AbstractRelationship)obj,AbstractPrimitiveProperty.this,propertyContainer.hasProperty(dbName()) ? propertyContainer.getProperty(dbName()) : null,value);
      }
    }
    try {
      if (convertedValue == null) {
        propertyContainer.removeProperty(dbName());
      }
 else {
        if (!AbstractPrimitiveProperty.this.equals(AbstractNode.lastModifiedDate)) {
          propertyContainer.setProperty(dbName(),convertedValue);
          propertyContainer.setProperty(AbstractNode.lastModifiedDate.dbName(),System.currentTimeMillis());
        }
 else {
          logger.log(Level.FINE,"Tried to set lastModifiedDate explicitly (action was denied)");
        }
      }
    }
 catch (    Throwable t) {
      t.printStackTrace();
      throw new FrameworkException(500,t);
    }
    if (isIndexed()) {
      if (!isPassivelyIndexed()) {
        index(obj,convertedValue);
      }
    }
  }
  return null;
}
