{
  if (entity instanceof AbstractNode) {
    NodeService nodeService=Services.getService(NodeService.class);
    AbstractNode node=(AbstractNode)entity;
    Node dbNode=node.getNode();
    for (    NodeIndex indexName : nodeIndices()) {
      Index<Node> index=nodeService.getNodeIndex(indexName);
      if (index != null) {
synchronized (index) {
          index.remove(dbNode,dbName);
          if (value != null && !StringUtils.isBlank(value.toString())) {
            try {
              index.add(dbNode,dbName,value);
            }
 catch (            NotFoundException e) {
              logger.log(Level.WARNING,"Could not add node to layer",e.getMessage());
            }
          }
 else           if (isIndexedWhenEmpty()) {
            value=getValueForEmptyFields();
            if (value != null) {
              index.add(dbNode,dbName,value);
            }
          }
        }
      }
    }
  }
 else {
    NodeService nodeService=Services.getService(NodeService.class);
    AbstractRelationship rel=(AbstractRelationship)entity;
    Relationship dbRel=rel.getRelationship();
    for (    RelationshipIndex indexName : relationshipIndices()) {
      Index<Relationship> index=nodeService.getRelationshipIndex(indexName);
      if (index != null) {
synchronized (index) {
          index.remove(dbRel,dbName);
          if (value != null && !StringUtils.isBlank(value.toString())) {
            index.add(dbRel,dbName,value);
          }
 else           if (isIndexedWhenEmpty()) {
            value=getValueForEmptyFields();
            if (value != null) {
              index.add(dbRel,dbName,value);
            }
          }
        }
      }
    }
  }
}
