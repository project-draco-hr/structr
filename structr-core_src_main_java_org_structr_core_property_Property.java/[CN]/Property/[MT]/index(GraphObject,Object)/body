{
  if (entity instanceof AbstractNode) {
    NodeService nodeService=Services.getService(NodeService.class);
    AbstractNode node=(AbstractNode)entity;
    for (    NodeIndex indexName : nodeIndices()) {
      Index<Node> index=nodeService.getNodeIndex(indexName);
      if (index != null) {
synchronized (index) {
          index.remove(node.getNode(),dbName);
          if (value != null) {
            index.add(node.getNode(),dbName,value);
          }
        }
      }
    }
  }
 else {
    NodeService nodeService=Services.getService(NodeService.class);
    AbstractRelationship rel=(AbstractRelationship)entity;
    for (    RelationshipIndex indexName : relationshipIndices()) {
      Index<Relationship> index=nodeService.getRelationshipIndex(indexName);
      if (index != null) {
synchronized (index) {
          index.remove(rel.getRelationship(),dbName);
          if (value != null) {
            index.add(rel.getRelationship(),dbName,value);
          }
        }
      }
    }
  }
}
