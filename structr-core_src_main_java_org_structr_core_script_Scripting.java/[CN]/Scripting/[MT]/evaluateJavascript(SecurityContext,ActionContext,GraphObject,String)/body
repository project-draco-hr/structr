{
  final Context scriptingContext=Context.enter();
  try {
    scriptingContext.setLanguageVersion(Context.VERSION_1_2);
    Scriptable scope=scriptingContext.initStandardObjects();
    final StructrScriptable scriptable=new StructrScriptable(securityContext,actionContext,entity);
    scope.put("Structr",scope,scriptable);
    Object extractedValue=scriptingContext.evaluateString(scope,embedInFunction(script),"source",1,null);
    if (scriptable.hasException()) {
      throw scriptable.getException();
    }
    if (extractedValue == null || extractedValue == Undefined.instance) {
      extractedValue=scope.get("_structrMainResult",scope);
    }
    if (extractedValue == null || extractedValue == Undefined.instance) {
      extractedValue="";
    }
    return extractedValue;
  }
  finally {
    Context.exit();
  }
}
