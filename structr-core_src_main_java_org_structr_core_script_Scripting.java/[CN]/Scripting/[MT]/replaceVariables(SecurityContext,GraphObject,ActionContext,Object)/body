{
  String value=null;
  if (rawValue == null) {
    return null;
  }
  if (rawValue instanceof String) {
    value=(String)rawValue;
    if (!actionContext.returnRawValue(securityContext)) {
      final StructrScriptable scriptable=new StructrScriptable(securityContext,actionContext,entity);
      final ScriptEngine engine=new ScriptEngineManager().getEngineByName(scriptEngineName);
      final Map<String,String> replacements=new LinkedHashMap<>();
      engine.put("Structr",scriptable);
      engine.put("_securityContext",securityContext);
      engine.put("_actionContext",actionContext);
      engine.put("_entity",entity);
      for (      final String expression : extractScripts(value)) {
        String source=expression.substring(2,expression.length() - 1);
        Object extractedValue=null;
        try {
          extractedValue=engine.eval(source);
        }
 catch (        ScriptException spex) {
          final Throwable cause=spex.getCause();
          if (cause instanceof FrameworkException) {
            throw (FrameworkException)cause;
          }
 else {
            throw new FrameworkException(500,spex.getMessage());
          }
        }
        if (extractedValue == null) {
          extractedValue="";
        }
        String partValue=extractedValue.toString();
        if (partValue != null) {
          replacements.put(expression,partValue);
        }
 else {
          if (!value.equals(expression)) {
            replacements.put(expression,"");
          }
        }
      }
      for (      final Map.Entry<String,String> entry : replacements.entrySet()) {
        final String group=entry.getKey();
        final String replacement=entry.getValue();
        value=value.replace(group,replacement);
      }
    }
  }
 else   if (rawValue instanceof Boolean) {
    value=Boolean.toString((Boolean)rawValue);
  }
 else {
    value=rawValue.toString();
  }
  if (Functions.NULL_STRING.equals(value)) {
    return null;
  }
  return value;
}
