{
  final App app=StructrApp.getInstance();
  long flagsValue=255;
  if (flags != null) {
    flagsValue=flags.longValue();
  }
  try {
    app.beginTx();
    for (    ResourceAccess grant : grants) {
      final String oldSignature=grant.getProperty(ResourceAccess.signature);
      if (oldSignature.startsWith("_schema/")) {
        grant.setProperty(ResourceAccess.signature,"_schema/" + signature);
      }
 else       if (oldSignature.endsWith("/_Ui")) {
        grant.setProperty(ResourceAccess.signature,signature + "/_Ui");
      }
 else {
        grant.setProperty(ResourceAccess.signature,signature);
      }
      grant.setProperty(ResourceAccess.flags,flagsValue);
    }
    app.commitTx();
  }
 catch (  Throwable t) {
    t.printStackTrace();
  }
 finally {
    app.finishTx();
  }
}
