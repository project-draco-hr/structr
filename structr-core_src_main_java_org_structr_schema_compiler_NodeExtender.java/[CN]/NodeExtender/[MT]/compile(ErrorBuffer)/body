{
  final Writer errorWriter=new StringWriter();
  final List<Class> newClasses=new LinkedList<>();
  if (!jfiles.isEmpty()) {
    logger.log(Level.INFO,"Compiling {0} dynamic entities",jfiles.size());
    compiler.getTask(errorWriter,fileManager,new Listener(errorBuffer),null,null,jfiles).call();
    final ClassLoader loader=fileManager.getClassLoader(null);
    boolean success=true;
    for (    final String fqcn : fqcns) {
      try {
        newClasses.add(loader.loadClass(fqcn));
      }
 catch (      Throwable t) {
        logger.log(Level.WARNING,"Unable to load dynamic entity {0}: {1}",new Object[]{fqcn,t.toString()});
        t.printStackTrace();
        success=false;
      }
    }
    if (success) {
      for (      final Class oldType : classes.values()) {
        StructrApp.getConfiguration().unregisterEntityType(oldType);
      }
      classes.clear();
      for (      final Class newType : newClasses) {
        classes.put(newType.getName(),newType);
      }
    }
  }
  return classes;
}
