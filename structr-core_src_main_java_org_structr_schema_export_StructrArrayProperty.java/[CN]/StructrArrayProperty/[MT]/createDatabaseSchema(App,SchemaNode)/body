{
  final String reference=getReference();
  if (reference != null) {
    final StructrDefinition def=resolveJsonPointer(reference);
    if (def != null) {
      final Set<String> properties=getProperties();
      final Direction direction=getDirection();
      if (direction == null || (properties != null && !properties.isEmpty())) {
        if (def instanceof JsonProperty) {
          final JsonProperty notionProperty=(JsonProperty)def;
          final SchemaProperty schemaProperty=app.create(SchemaProperty.class,new NodeAttribute(AbstractNode.name,getName()),new NodeAttribute(SchemaProperty.schemaNode,schemaNode),new NodeAttribute(SchemaProperty.propertyType,Type.Notion.name()),new NodeAttribute(SchemaProperty.format,notionProperty.getName() + ", " + StringUtils.join(properties,", ")));
          return schemaProperty;
        }
 else         if (def instanceof JsonType) {
          System.out.println("########################################################################################");
          System.out.println("createDatabaseSchema for array property " + this);
          System.out.println("encountered type: " + def.getClass().getName());
        }
      }
 else {
        final SchemaNode otherNode=def.getSchemaNode();
        String relationship=getRelationship();
switch (direction) {
case out:
          if (StringUtils.isEmpty(relationship)) {
            relationship=SchemaRelationshipNode.getDefaultRelationshipType(schemaNode,otherNode);
          }
        final SchemaRelationshipNode outRel=StructrDefinition.getRelationship(app,schemaNode,otherNode,relationship);
      outRel.resolveCascadingEnums(getCascadingDelete(),getCascadingCreate());
    outRel.setProperty(SchemaRelationshipNode.targetJsonName,getName());
  outRel.setProperty(SchemaRelationshipNode.targetMultiplicity,"*");
break;
case in:
if (StringUtils.isEmpty(relationship)) {
relationship=SchemaRelationshipNode.getDefaultRelationshipType(otherNode,schemaNode);
}
final SchemaRelationshipNode inRel=StructrDefinition.getRelationship(app,otherNode,schemaNode,relationship);
inRel.resolveCascadingEnums(getCascadingDelete(),getCascadingCreate());
inRel.setProperty(SchemaRelationshipNode.sourceJsonName,getName());
inRel.setProperty(SchemaRelationshipNode.sourceMultiplicity,"*");
break;
default :
throw new IllegalStateException("Invalid direction " + direction + " for property "+ getName()+ " in type "+ getParent().getName());
}
}
}
}
return null;
}
