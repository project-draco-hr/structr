{
  SchemaNode task=null;
  SchemaNode worker=null;
  try (final Tx tx=app.tx()){
    Map<String,PropertyMap> notionPropertyMap=new HashMap<>();
    securityContext.setAttribute("notionProperties",notionPropertyMap);
    task=createTestNode(SchemaNode.class,"Task");
    worker=createTestNode(SchemaNode.class,"Worker");
    final PropertyMap taskTaskProperties=new PropertyMap();
    taskTaskProperties.put(SchemaRelationship.relationshipType,"SUBTASK");
    notionPropertyMap.put("TaskIS_RELATED_TOTask",taskTaskProperties);
    task.setProperty(SchemaNode.relatedTo,toList(task));
    final PropertyMap workerTaskProperties=new PropertyMap();
    workerTaskProperties.put(SchemaRelationship.relationshipType,"WORKS_ON");
    notionPropertyMap.put("WorkerIS_RELATED_TOTask",workerTaskProperties);
    task.setProperty(SchemaNode.relatedFrom,toList(worker));
    tx.success();
  }
 catch (  FrameworkException fex) {
    fex.printStackTrace();
    fail("Unexpected exception.");
  }
  try (final Tx tx=app.tx()){
    final List<SchemaNode> relatedTos=task.getProperty(SchemaNode.relatedTo);
    final List<SchemaNode> relatedFroms=task.getProperty(SchemaNode.relatedFrom);
    assertEquals("Invalid cardinality result",1,relatedTos.size());
    assertEquals("Invalid cardinality result",2,relatedFroms.size());
    tx.success();
  }
 catch (  FrameworkException fex) {
    fex.printStackTrace();
    fail("Unexpected exception.");
  }
}
