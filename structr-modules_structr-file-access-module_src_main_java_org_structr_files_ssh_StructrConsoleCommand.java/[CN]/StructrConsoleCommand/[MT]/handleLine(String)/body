{
  if (StringUtils.isNotBlank(line)) {
    if (insideOfBlockOrStructure()) {
      buf.append(line);
      buf.append("\n");
    }
 else {
      buf.append(line);
    }
    checkForBlockChars(line.trim());
    if (!insideOfBlockOrStructure()) {
      commandHistory.add(buf.toString());
      try (final Tx tx=StructrApp.getInstance(console.getSecurityContext()).tx()){
        final String cmd=buf.toString();
        final String ret=console.run(cmd);
        term.println(ret);
        tx.success();
      }
 catch (      Throwable t) {
        final String message=t.getMessage();
        if (message != null) {
          term.println(message);
        }
 else {
          t.printStackTrace();
          term.println(t.getClass().getSimpleName() + " encountered.");
        }
      }
      clearBlockStatus();
    }
  }
}
