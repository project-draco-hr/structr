{
  final Set<PropertyKey> properties=new LinkedHashSet<>(StructrApp.getConfiguration().getPropertySet(type,view));
  final Map<String,Object> propertyConverterMap=new LinkedHashMap<>();
  List<SchemaProperty> schemaProperties=null;
  try {
    SchemaNode schemaNode=StructrApp.getInstance().nodeQuery(SchemaNode.class).andName(type.getSimpleName()).getFirst();
    if (schemaNode != null) {
      schemaProperties=schemaNode.schemaProperties.getProperty(securityContext,schemaNode,false);
    }
  }
 catch (  FrameworkException ex) {
    Logger.getLogger(SchemaTypeResource.class.getName()).log(Level.SEVERE,"Error looking up SchemaNode - cannot display labels for properties!",ex);
  }
  for (  PropertyKey property : properties) {
    final Map<String,Object> propProperties=new LinkedHashMap();
    propProperties.put("dbName",property.dbName());
    propProperties.put("jsonName",property.jsonName());
    propProperties.put("className",property.getClass().getName());
    final Class declaringClass=property.getDeclaringClass();
    propProperties.put("declaringClass",declaringClass.getSimpleName());
    propProperties.put("defaultValue",property.defaultValue());
    if (property instanceof StringProperty) {
      propProperties.put("contentType",((StringProperty)property).contentType());
    }
    propProperties.put("format",property.format());
    propProperties.put("readOnly",property.isReadOnly());
    propProperties.put("system",property.isUnvalidated());
    propProperties.put("indexed",property.isIndexed());
    propProperties.put("indexedWhenEmpty",property.isIndexedWhenEmpty());
    propProperties.put("unique",property.isUnique());
    propProperties.put("notNull",property.isNotNull());
    propProperties.put("dynamic",property.isDynamic());
    if (property.isDynamic() && schemaProperties != null) {
      for (      final SchemaProperty sProp : schemaProperties) {
        if (sProp.getName().equals(property.jsonName())) {
          final List<SchemaLabel> labels=sProp.labels.getProperty(securityContext,sProp,false);
          final List<Map<String,Object>> labelMap=new ArrayList<>(labels.size());
          for (          final SchemaLabel lbl : labels) {
            final HashMap tmpMap=new HashMap(3);
            tmpMap.put("id",lbl.getProperty(SchemaLabel.id));
            tmpMap.put("locale",lbl.getProperty(SchemaLabel.locale));
            tmpMap.put("name",lbl.getProperty(SchemaLabel.name));
            labelMap.add(tmpMap);
          }
          propProperties.put("labels",labelMap);
          break;
        }
      }
    }
    final Class<? extends GraphObject> relatedType=property.relatedType();
    if (relatedType != null) {
      propProperties.put("relatedType",relatedType.getName());
      propProperties.put("type",relatedType.getSimpleName());
    }
 else {
      propProperties.put("type",property.typeName());
    }
    propProperties.put("isCollection",property.isCollection());
    final PropertyConverter databaseConverter=property.databaseConverter(securityContext,null);
    final PropertyConverter inputConverter=property.inputConverter(securityContext);
    if (databaseConverter != null) {
      propProperties.put("databaseConverter",databaseConverter.getClass().getName());
    }
    if (inputConverter != null) {
      propProperties.put("inputConverter",inputConverter.getClass().getName());
    }
    if (declaringClass != null && property instanceof RelationProperty) {
      Relation relation=((RelationProperty)property).getRelation();
      if (relation != null) {
        propProperties.put("relationshipType",relation.name());
      }
    }
    propertyConverterMap.put(property.jsonName(),propProperties);
  }
  return propertyConverterMap;
}
