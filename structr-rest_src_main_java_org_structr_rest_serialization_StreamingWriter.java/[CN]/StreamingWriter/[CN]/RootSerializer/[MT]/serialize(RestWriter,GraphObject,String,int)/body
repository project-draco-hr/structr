{
  String id=null;
  if (source != null) {
    id=source.getUuid();
    if (id != null) {
      visitedObjects.add(id);
    }
  }
  writer.beginObject(source);
  if (depth <= outputNestingDepth) {
    Iterable<PropertyKey> keys=source.getPropertyKeys(localPropertyView);
    if (keys != null) {
      if (compactNestedProperties && depth > 0 && PropertyView.Ui.equals(localPropertyView)) {
        keys=idNameOnly;
      }
      for (      PropertyKey key : keys) {
        final Predicate predicate=writer.getSecurityContext().getRange(key.jsonName());
        final Object value=source.getProperty(key,predicate);
        final PropertyKey localKey=key;
        if (value != null) {
          boolean skip=false;
          if (reduceRedundancy && value instanceof GraphObject) {
            String valueId=((GraphObject)value).getUuid();
            if (valueId != null) {
              skip=visitedObjects.contains(valueId);
            }
          }
          if (skip) {
            continue;
          }
 else {
            writer.name(localKey.jsonName());
            serializeProperty(writer,key,value,localPropertyView,depth + 1);
          }
        }
 else {
          writer.name(localKey.jsonName()).nullValue();
        }
      }
    }
  }
  writer.endObject(source);
  if (id != null) {
    visitedObjects.remove(id);
  }
}
