{
  while (isConnected()) {
    try {
      final Message request=receiver.receive();
      if (request != null) {
        if (CloudService.DEBUG) {
          System.out.println(System.currentTimeMillis() + "        RECEIVED " + request);
        }
        refreshTransmissionTimeout();
        if (request.wasSentFromHere()) {
          request.onResponse(this,context);
        }
 else {
          request.onRequest(this,context);
        }
      }
    }
 catch (    Throwable t) {
      t.printStackTrace();
    }
  }
  shutdown();
  logger.log(Level.INFO,"Transmission finished");
}
