{
  final SecurityContext securityContext=SecurityContext.getSuperUserInstance();
  final NodeDataContainer receivedNodeData=(NodeDataContainer)receivedData;
  final String typeName=receivedNodeData.getType();
  final Class nodeType=config.getNodeEntityClass(typeName);
  if (nodeType == null) {
    logger.log(Level.SEVERE,"Unknown entity type {0}",typeName);
    return null;
  }
  final String uuid=receivedNodeData.getSourceNodeId();
  GraphObject newOrExistingNode=app.get(nodeType,uuid);
  if (newOrExistingNode != null) {
    newOrExistingNode.updateFromPropertyMap(receivedNodeData.getProperties());
  }
 else {
    final PropertyMap properties=PropertyMap.databaseTypeToJavaType(securityContext,nodeType,receivedNodeData.getProperties());
    newOrExistingNode=app.create(nodeType,properties);
  }
  idMap.put(receivedNodeData.getSourceNodeId(),newOrExistingNode.getUuid());
  return (NodeInterface)newOrExistingNode;
}
