{
  FileNodeDataContainer container=new FileNodeDataContainer(file);
  client.send(container);
  context.progress();
  for (  FileNodeChunk chunk : FileNodeDataContainer.getChunks(file,chunkSize)) {
    client.send(chunk);
    context.progress();
    if (((chunk.getSequenceNumber() + 1) % LIVE_PACKET_COUNT) == 0) {
      client.waitForMessage();
    }
  }
  client.send(new FileNodeEndChunk(container.getSourceNodeId(),container.getFileSize()));
  context.progress();
  client.waitForMessage();
}
