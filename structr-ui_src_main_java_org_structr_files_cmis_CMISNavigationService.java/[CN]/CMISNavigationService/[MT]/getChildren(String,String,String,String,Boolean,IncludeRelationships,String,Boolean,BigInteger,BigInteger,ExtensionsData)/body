{
  final App app=StructrApp.getInstance();
  if (folderId != null) {
    final CMISObjectInFolderWrapper wrapper=new CMISObjectInFolderWrapper(propertyFilter,includeAllowableActions,maxItems,skipCount);
    try (final Tx tx=app.tx()){
      final Query query=app.nodeQuery(AbstractFile.class).sort(AbstractNode.name);
      if (CMISInfo.ROOT_FOLDER_ID.equals(folderId)) {
        query.and(AbstractFile.hasParent,false).not().and(Image.isThumbnail,true);
      }
 else {
        final Folder parent=app.get(Folder.class,folderId);
        query.and(AbstractFile.parent,parent).and(Image.isThumbnail,false);
      }
      wrapper.wrap(query.getAsList());
      tx.success();
      return wrapper;
    }
 catch (    Throwable t) {
      t.printStackTrace();
    }
  }
  throw new CmisObjectNotFoundException("Folder with ID " + folderId + " does not exist");
}
