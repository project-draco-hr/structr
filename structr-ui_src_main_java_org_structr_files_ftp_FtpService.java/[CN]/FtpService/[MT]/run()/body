{
  String configuredPort=Services.getFtpPort();
  if (StringUtils.isBlank(configuredPort)) {
    logger.log(Level.SEVERE,"Unable to start FTP service. Reason: No FTP port configured.");
    return;
  }
  port=Integer.parseInt(configuredPort);
  try {
    FtpServerFactory serverFactory=new FtpServerFactory();
    serverFactory.setUserManager(new StructrUserManager());
    serverFactory.setFileSystem(new StructrFileSystemFactory());
    ListenerFactory factory=new ListenerFactory();
    factory.setPort(port);
    serverFactory.addListener("default",factory.createListener());
    logger.log(Level.INFO,"Starting FTP server on port {0}",new Object[]{port});
    server=serverFactory.createServer();
    server.start();
    this.doRun=true;
  }
 catch (  FtpException ex) {
    logger.log(Level.SEVERE,null,ex);
  }
}
