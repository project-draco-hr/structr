{
  logger.log(Level.INFO,"Requested path: {0}",requestedPath);
  try (Tx tx=StructrApp.getInstance().tx()){
    if (StringUtils.isBlank(requestedPath) || "/".equals(requestedPath)) {
      return getHomeDirectory();
    }
    StructrFtpFolder cur=(StructrFtpFolder)getWorkingDirectory();
    if (".".equals(requestedPath) || "./".equals(requestedPath)) {
      return cur;
    }
    if ("..".equals(requestedPath) || "../".equals(requestedPath)) {
      return new StructrFtpFolder(cur.getStructrFile().getProperty(AbstractFile.parent));
    }
    if (!requestedPath.startsWith("/")) {
      String basePath=cur.getAbsolutePath();
      logger.log(Level.INFO,"Base path: {0}",basePath);
      while (requestedPath.startsWith("..")) {
        requestedPath=StringUtils.stripStart(StringUtils.stripStart(requestedPath,".."),"/");
        basePath=StringUtils.substringBeforeLast(basePath,"/");
      }
      requestedPath=StringUtils.stripEnd(basePath.equals("/") ? "/".concat(requestedPath) : basePath.concat("/").concat(requestedPath),"/");
      logger.log(Level.INFO,"Base path: {0}, requestedPath: {1}",new Object[]{basePath,requestedPath});
    }
    AbstractFile file=FileHelper.getFileByAbsolutePath(requestedPath);
    if (file != null) {
      if (file instanceof Folder) {
        return new StructrFtpFolder((Folder)file);
      }
 else {
        return new StructrFtpFile((File)file);
      }
    }
    logger.log(Level.WARNING,"No existing file found: {0}",requestedPath);
    return new FileOrFolder(requestedPath,user);
  }
 catch (  FrameworkException fex) {
    logger.log(Level.SEVERE,"Error in getFile()",fex);
  }
  return null;
}
