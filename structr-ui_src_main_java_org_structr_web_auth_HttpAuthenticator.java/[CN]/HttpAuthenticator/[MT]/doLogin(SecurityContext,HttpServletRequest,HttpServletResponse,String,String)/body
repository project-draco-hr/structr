{
  Principal user=AuthHelper.getPrincipalForPassword(Person.email,emailOrUsername,password);
  if (user == null) {
    user=AuthHelper.getPrincipalForPassword(AbstractNode.name,emailOrUsername,password);
  }
  if (user != null) {
    securityContext.setUser(user);
    final String sessionIdFromRequest=request.getRequestedSessionId();
    final Principal principal=user;
    try {
      Services.command(securityContext,TransactionCommand.class).execute(new StructrTransaction(){
        @Override public Object execute() throws FrameworkException {
          principal.setProperty(Principal.sessionId,sessionIdFromRequest);
          return null;
        }
      }
);
    }
 catch (    Exception ex) {
      logger.log(Level.SEVERE,null,ex);
    }
  }
  return user;
}
