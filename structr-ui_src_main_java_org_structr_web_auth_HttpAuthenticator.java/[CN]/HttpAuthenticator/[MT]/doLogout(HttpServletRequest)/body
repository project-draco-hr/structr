{
  final App app=StructrApp.getInstance();
  try {
    app.beginTx();
    Principal user=getUser(request,false);
    if (user != null) {
      user.setProperty(Principal.sessionId,null);
    }
    HttpSession session=request.getSession(false);
    if (session != null) {
      session.invalidate();
    }
    request.logout();
    app.finishTx();
  }
 catch (  Exception ex) {
    logger.log(Level.WARNING,"Error while logging out user",ex);
  }
 finally {
    app.finishTx();
  }
}
