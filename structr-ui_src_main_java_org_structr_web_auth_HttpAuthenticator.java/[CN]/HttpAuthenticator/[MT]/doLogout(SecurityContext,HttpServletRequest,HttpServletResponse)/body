{
  try {
    Principal user=securityContext.getUser(false);
    if (user != null) {
      final Principal principal=user;
      Services.command(securityContext,TransactionCommand.class).execute(new StructrTransaction(){
        @Override public Object execute() throws FrameworkException {
          principal.setProperty(Principal.sessionId,null);
          return null;
        }
      }
);
    }
    HttpSession session=request.getSession(false);
    if (session != null) {
      session.invalidate();
    }
    request.logout();
    securityContext.setUser(null);
  }
 catch (  Exception ex) {
    logger.log(Level.WARNING,"Error while logging out user",ex);
  }
}
