{
  if (tokenResponse != null) {
    return tokenResponse;
  }
  try {
    String code=getCode(request);
    if (code == null) {
      logger.log(Level.SEVERE,"Could not get code from request, cancelling authorization process");
      return null;
    }
    OAuthClientRequest clientReq=OAuthClientRequest.tokenLocation(tokenLocation).setGrantType(GrantType.AUTHORIZATION_CODE).setClientId(clientId).setClientSecret(clientSecret).setRedirectURI(getAbsoluteRedirectUri(request,redirectUri)).setCode(getCode(request)).buildBodyMessage();
    logger.log(Level.INFO,"Request body: {0}",clientReq.getBody());
    OAuthClient oAuthClient=new OAuthClient(new URLConnectionClient());
    if (ResponseFormat.urlEncoded.equals(getResponseType())) {
      tokenResponse=oAuthClient.accessToken(clientReq,GitHubTokenResponse.class);
    }
 else {
      tokenResponse=oAuthClient.accessToken(clientReq);
    }
    logger.log(Level.INFO,"Access token response: {0}",tokenResponse.getBody());
    return tokenResponse;
  }
 catch (  Throwable t) {
    logger.log(Level.SEVERE,"Could not get access token response",t);
  }
  return null;
}
