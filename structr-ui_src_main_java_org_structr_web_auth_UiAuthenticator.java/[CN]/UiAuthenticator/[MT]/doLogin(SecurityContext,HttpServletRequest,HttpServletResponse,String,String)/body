{
  Principal user=AuthHelper.getPrincipalForPassword(Person.email,emailOrUsername,password);
  if (user != null) {
    HttpSession session=request.getSession(false);
    if (session != null) {
      final String sessionIdFromRequest=session.getId();
      final Principal principal=useR;
      try {
        Services.command(securityContext,TransactionCommand.class).execute(new StructrTransaction(){
          @Override public Object execute() throws FrameworkException {
            principal.setProperty(Principal.sessionId,sessionIdFromRequest);
            return null;
          }
        }
);
      }
 catch (      Exception ex) {
        logger.log(Level.SEVERE,null,ex);
      }
    }
    securityContext.setUser(user);
  }
  return user;
}
