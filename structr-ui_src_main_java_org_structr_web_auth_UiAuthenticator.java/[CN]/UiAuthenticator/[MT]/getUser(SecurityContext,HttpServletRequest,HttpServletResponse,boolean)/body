{
  Principal user=checkSessionAuthentication(request,response);
  if (user != null) {
    securityContext.setUser(user);
    return user;
  }
  String userName=request.getHeader("X-User");
  String password=request.getHeader("X-Password");
  String token=request.getHeader("X-StructrSessionToken");
  if (token != null) {
    user=AuthHelper.getPrincipalForSessionId(token);
  }
 else   if ((userName != null) && (password != null)) {
    if (tryLogin) {
      user=AuthHelper.getPrincipalForPassword(AbstractNode.name,userName,password);
    }
  }
  if (user != null) {
    securityContext.setUser(user);
  }
  return user;
}
