{
  while (async == null || out.isReady()) {
    String s=queue.poll();
    if (s == null) {
      out.flush();
      return;
    }
    if (!completed) {
      out.write(s.getBytes("UTF-8"));
    }
  }
}
