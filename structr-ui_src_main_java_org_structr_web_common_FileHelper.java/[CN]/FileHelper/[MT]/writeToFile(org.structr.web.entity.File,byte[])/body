{
  String uuid=fileNode.getProperty(GraphObject.id);
  if (uuid == null) {
    final String newUuid=UUID.randomUUID().toString().replaceAll("[\\-]+","");
    final App app=StructrApp.getInstance(fileNode.getSecurityContext());
    uuid=newUuid;
    try {
      app.beginTx();
      fileNode.unlockReadOnlyPropertiesOnce();
      fileNode.setProperty(GraphObject.id,newUuid);
      app.commitTx();
    }
  finally {
      app.finishTx();
    }
  }
  fileNode.setRelativeFilePath(org.structr.web.entity.File.getDirectoryPath(uuid) + "/" + uuid);
  final String filesPath=Services.getInstance().getConfigurationValue(Services.FILES_PATH);
  java.io.File fileOnDisk=new java.io.File(filesPath + "/" + fileNode.getRelativeFilePath());
  fileOnDisk.getParentFile().mkdirs();
  FileUtils.writeByteArrayToFile(fileOnDisk,data);
}
