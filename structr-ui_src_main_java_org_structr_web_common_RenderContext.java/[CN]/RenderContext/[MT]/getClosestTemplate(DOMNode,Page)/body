{
  while (node != null) {
    if (node instanceof Template) {
      final Template template=(Template)node;
      Document doc=template.getOwnerDocument();
      if (doc == null) {
        doc=getClosestPage(node);
      }
      if (doc != null && doc.equals(page)) {
        try {
          template.setProperty(DOMNode.ownerDocument,(Page)doc);
          return template;
        }
 catch (        FrameworkException ex) {
          ex.printStackTrace();
        }
      }
      final List<DOMNode> syncedNodes=template.getProperty(DOMNode.syncedNodes);
      for (      final DOMNode syncedNode : syncedNodes) {
        doc=syncedNode.getOwnerDocument();
        if (doc != null && doc.equals(page)) {
          return (Template)syncedNode;
        }
      }
    }
    node=(DOMNode)node.getParentNode();
  }
  return null;
}
