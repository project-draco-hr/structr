{
  if (source == null) {
    return false;
  }
  try {
    Services.command(securityContext,TransactionCommand.class).execute(new StructrTransaction(){
      @Override public Object execute() throws FrameworkException {
        Image img=null;
        try {
          if (source instanceof byte[]) {
            byte[] data=(byte[])source;
            MagicMatch match=Magic.getMagicMatch(data);
            String mimeType=match.getMimeType();
            if (keyAndClass != null) {
              img=ImageHelper.createImage(securityContext,data,mimeType,keyAndClass.getCls());
            }
 else {
              ImageHelper.setImageData((Image)currentObject,data,mimeType);
            }
          }
 else           if (source instanceof String) {
            if (StringUtils.isNotBlank((String)source)) {
              if (keyAndClass != null) {
                img=ImageHelper.createImageBase64(securityContext,(String)source,keyAndClass != null ? keyAndClass.getCls() : null);
              }
 else {
                ImageHelper.decodeAndSetImageData((Image)currentObject,(String)source);
              }
            }
          }
        }
 catch (        Throwable t) {
          logger.log(Level.WARNING,"Cannot create image node from given data",t);
        }
        if (img != null) {
          Services.command(securityContext,NewIndexNodeCommand.class).updateNode(img);
          currentObject.setProperty(keyAndClass.getPropertyKey(),img);
        }
        return null;
      }
    }
);
  }
 catch (  Throwable t) {
    logger.log(Level.WARNING,"Cannot create image node from given data",t);
  }
  return null;
}
