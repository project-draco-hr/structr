{
  if (((Image)this.currentObject).getProperty(Image.isThumbnail)) {
    return null;
  }
  final Image thumbnail=((Image)currentObject).getScaledImage(parameters.getMaxWidth(),parameters.getMaxHeight(),parameters.getCropToFit());
  if (thumbnail == null) {
    logger.log(Level.WARNING,"Could not create thumbnail for {0}",source);
    return null;
  }
  try {
    Services.command(securityContext,TransactionCommand.class).execute(new StructrTransaction(){
      @Override public Object execute() throws FrameworkException {
        thumbnail.setProperty(Image.isThumbnail,true);
        return null;
      }
    }
);
  }
 catch (  FrameworkException ex) {
    logger.log(Level.WARNING,"Could not set isThumbnail property on {0}",thumbnail);
  }
  return thumbnail;
}
