{
  if (isDeleted() || isHidden()) {
    return;
  }
  double start=System.nanoTime();
  EditMode edit=renderContext.getEditMode();
  boolean isVoid=isVoidElement();
  StringBuilder buffer=renderContext.getBuffer();
  String id=getUuid();
  String tag=getProperty(DOMElement.tag);
  boolean anyChildNodeCreatesNewLine=false;
  if (!avoidWhitespace()) {
    buffer.append(indent(depth));
  }
  if (StringUtils.isNotBlank(tag)) {
    buffer.append("<").append(tag);
    if (EditMode.DATA.equals(edit)) {
      buffer.append(" data-structr-id=\"").append(id).append("\"");
      if (renderContext.getDataObject() != null) {
        buffer.append(" data-structr-data-type=\"").append(renderContext.getDataObject().getType()).append("\"");
      }
      PropertyKey r=renderContext.getRelatedProperty();
      if (r != null) {
        buffer.append(" data-structr-related-property=\"").append(r.jsonName()).append("\"");
        buffer.append(" data-structr-source-type=\"").append(r.getDeclaringClass().getSimpleName()).append("\"");
        buffer.append(" data-structr-source-id=\"").append(renderContext.getSourceDataObject().getUuid()).append("\"");
        buffer.append(" data-structr-data-id=\"").append(renderContext.getDataObject().getUuid()).append("\"");
      }
    }
    for (    PropertyKey attribute : EntityContext.getPropertySet(getClass(),PropertyView.Html)) {
      try {
        String value=getPropertyWithVariableReplacement(securityContext,renderContext,attribute);
        if ((value != null) && StringUtils.isNotBlank(value)) {
          String key=attribute.jsonName().substring(PropertyView.Html.length());
          buffer.append(" ").append(key).append("=\"").append(value).append("\"");
        }
      }
 catch (      Throwable t) {
        t.printStackTrace();
      }
    }
    buffer.append(">");
    if (Body.class.getSimpleName().toLowerCase().equals(this.getTagName())) {
      renderContext.setInBody(true);
    }
    List<AbstractRelationship> rels=getChildRelationships();
    if (rels.isEmpty()) {
      for (      AbstractRelationship syncRel : getRelationships(RelType.SYNC,Direction.INCOMING)) {
        DOMElement syncedNode=(DOMElement)syncRel.getStartNode();
        rels.addAll(syncedNode.getChildRelationships());
      }
    }
    for (    AbstractRelationship rel : rels) {
      DOMNode subNode=(DOMNode)rel.getEndNode();
      if (!securityContext.isVisible(subNode)) {
        continue;
      }
      GraphObject details=renderContext.getDetailsDataObject();
      boolean detailMode=details != null;
      if (EditMode.DATA.equals(edit) && subNode.getProperty(hideOnEdit)) {
        continue;
      }
      if (!EditMode.DATA.equals(edit) && subNode.getProperty(hideOnNonEdit)) {
        continue;
      }
      if (detailMode && subNode.getProperty(hideOnDetail)) {
        continue;
      }
      if (!detailMode && subNode.getProperty(hideOnIndex)) {
        continue;
      }
      if (subNode instanceof DOMElement) {
        anyChildNodeCreatesNewLine=(anyChildNodeCreatesNewLine || !((DOMElement)subNode).avoidWhitespace());
      }
      String subKey=subNode.getProperty(dataKey);
      if (StringUtils.isNotBlank(subKey)) {
        setDataRoot(renderContext,subNode,subKey);
        GraphObject currentDataNode=renderContext.getDataObject();
        List<GraphObject> listData=((DOMElement)subNode).checkListSources(securityContext,renderContext);
        PropertyKey propertyKey=null;
        Class typeForCreateButton=null;
        String sourceId=null;
        String sourceType=null;
        String relatedProperty=null;
        if (subNode.getProperty(renderDetails) && detailMode) {
          renderContext.setDataObject(details);
          renderContext.putDataObject(subKey,details);
          subNode.render(securityContext,renderContext,depth + 1);
        }
 else {
          if (listData.isEmpty() && currentDataNode != null) {
            Object elements=currentDataNode.getProperty(new GenericProperty(subKey));
            renderContext.setRelatedProperty(new GenericProperty(subKey));
            renderContext.setSourceDataObject(currentDataNode);
            if (elements != null) {
              if (elements instanceof Iterable) {
                int i=0;
                for (                Object o : (Iterable)elements) {
                  if (o instanceof GraphObject) {
                    if (i == 0 && EditMode.DATA.equals(edit) && o instanceof AbstractNode) {
                      typeForCreateButton=((AbstractNode)o).getClass();
                    }
                    i++;
                    GraphObject graphObject=(GraphObject)o;
                    renderContext.putDataObject(subKey,graphObject);
                    subNode.render(securityContext,renderContext,depth + 1);
                  }
                }
              }
            }
 else {
              propertyKey=EntityContext.getPropertyKeyForJSONName(currentDataNode.getClass(),subKey,false);
              renderContext.setRelatedProperty(propertyKey);
              if (propertyKey != null && propertyKey instanceof CollectionProperty) {
                CollectionProperty<AbstractNode> collectionProperty=(CollectionProperty)propertyKey;
                for (                AbstractNode node : currentDataNode.getProperty(collectionProperty)) {
                  renderContext.putDataObject(subKey,node);
                  subNode.render(securityContext,renderContext,depth + 1);
                }
                typeForCreateButton=collectionProperty.getDestType();
                sourceId=currentDataNode.getUuid();
                sourceType=currentDataNode.getType();
                relatedProperty=collectionProperty.jsonName();
              }
            }
            renderContext.setDataObject(currentDataNode);
            renderContext.setRelatedProperty(null);
          }
 else {
            if (!listData.isEmpty()) {
              typeForCreateButton=listData.get(0).getClass();
            }
            renderContext.setListSource(listData);
            ((DOMElement)subNode).renderNodeList(securityContext,renderContext,depth,subKey);
          }
          if (EditMode.DATA.equals(edit) && typeForCreateButton != null && !Renderable.class.isAssignableFrom(typeForCreateButton)) {
            buffer.append("\n<div class=\"structr-edit\"><button class=\"createButton\"");
            if (sourceId != null) {
              buffer.append(" data-structr-source-id=\"").append(sourceId).append("\"");
              buffer.append(" data-structr-source-type=\"").append(sourceType).append("\"");
              buffer.append(" data-structr-related-property=\"").append(relatedProperty).append("\"");
            }
            buffer.append(" data-structr-type=\"").append(typeForCreateButton.getSimpleName()).append("\">").append(relatedProperty != null ? "Add " + typeForCreateButton.getSimpleName() + " to "+ relatedProperty : "Create new " + typeForCreateButton.getSimpleName()).append("</button></div>\n");
          }
        }
      }
 else {
        subNode.render(securityContext,renderContext,depth + 1);
      }
    }
    if (StringUtils.isNotBlank(tag) && (!isVoid)) {
      if (anyChildNodeCreatesNewLine) {
        buffer.append(indent(depth));
      }
      buffer.append("</").append(tag).append(">");
    }
  }
  double end=System.nanoTime();
  logger.log(Level.FINE,"Render node {0} in {1} seconds",new java.lang.Object[]{getUuid(),decimalFormat.format((end - start) / 1000000000.0)});
}
