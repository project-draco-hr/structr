{
  final String DEFAULT_VALUE_SEP="!";
  String pageId=renderContext.getPageId();
  String[] parts=refKey.split("[\\.]+");
  String referenceKey=parts[parts.length - 1];
  String defaultValue=null;
  if (StringUtils.contains(referenceKey,DEFAULT_VALUE_SEP)) {
    String[] ref=StringUtils.split(referenceKey,DEFAULT_VALUE_SEP);
    referenceKey=ref[0];
    if (ref.length > 1) {
      defaultValue=ref[1];
    }
 else {
      defaultValue="";
    }
  }
  Page _page=renderContext.getPage();
  GraphObject _data=null;
  for (int i=0; (i < parts.length); i++) {
    String part=parts[i];
    if (_data != null) {
      Object value=_data.getProperty(EntityContext.getPropertyKeyForJSONName(_data.getClass(),part));
      if (value instanceof GraphObject) {
        _data=(GraphObject)value;
        continue;
      }
      if ("link".equals(part.toLowerCase()) && _data instanceof AbstractNode) {
        for (        AbstractRelationship rel : ((AbstractNode)_data).getRelationships(org.structr.web.common.RelType.LINK,Direction.OUTGOING)) {
          _data=rel.getEndNode();
          break;
        }
        continue;
      }
    }
    if (renderContext.hasDataForKey(part.toLowerCase())) {
      _data=renderContext.getDataNode(part.toLowerCase());
      continue;
    }
    if ("request".equals(part.toLowerCase())) {
      HttpServletRequest request=renderContext.getRequest();
      if (request != null) {
        if (StringUtils.contains(referenceKey,"!")) {
          String[] ref=StringUtils.split(referenceKey,"!");
          return StringUtils.defaultString(request.getParameter(ref[0]),ref.length > 1 ? ref[1] : "");
        }
 else {
          return StringUtils.defaultString(request.getParameter(referenceKey));
        }
      }
    }
    if ("me".equals(part.toLowerCase())) {
      User me=(User)securityContext.getUser(false);
      if (me != null) {
        _data=me;
        continue;
      }
    }
    if (_data == null) {
      if ("page".equals(part.toLowerCase())) {
        _data=_page;
        continue;
      }
      if (_data == null && "link".equals(part.toLowerCase())) {
        for (        AbstractRelationship rel : getRelationships(org.structr.web.common.RelType.LINK,Direction.OUTGOING)) {
          _data=rel.getEndNode();
          break;
        }
        continue;
      }
      if ("parent".equals(part.toLowerCase())) {
        _data=(DOMNode)getParentNode();
        continue;
      }
      if ("owner".equals(part.toLowerCase())) {
        for (        AbstractRelationship rel : getRelationships(org.structr.common.RelType.OWNS,Direction.INCOMING)) {
          _data=rel.getStartNode();
          break;
        }
        continue;
      }
      if ("result_size".equals(part.toLowerCase())) {
        Set<Page> pages=getResultPages(securityContext,(Page)_page);
        if (!pages.isEmpty()) {
          return pages.size();
        }
        return 0;
      }
    }
  }
  if (_data != null) {
    PropertyKey referenceKeyProperty=EntityContext.getPropertyKeyForJSONName(_data.getClass(),referenceKey);
    return getEditModeValue(securityContext,renderContext,_data,referenceKeyProperty,defaultValue);
  }
  return null;
}
