{
  final App app=StructrApp.getInstance(securityContext);
  try {
    if (imageNode != null) {
      app.beginTx();
      String url=imageNode.getUrl();
      String relativeFilePath=imageNode.getRelativeFilePath();
      String imageName=url.substring(url.lastIndexOf("/") + 1);
      imageNode.setProperty(AbstractNode.name,imageName);
      if (relativeFilePath == null) {
        relativeFilePath=imageNode.getId() + "_" + System.currentTimeMillis();
      }
      String path=Services.getFilePath(Path.Files,relativeFilePath);
      if (StringUtils.isNotBlank(url)) {
        try {
          File imageFile=new File(path);
          URL imageUrl=new URL(url);
          FileUtils.copyURLToFile(imageUrl,imageFile);
          imageNode.setRelativeFilePath(relativeFilePath);
          logger.log(Level.INFO,"Image {0} ({1}) saved from URL {2}",new Object[]{imageNode.getName(),imageNode.getId(),url});
        }
 catch (        Throwable t) {
          logger.log(Level.SEVERE,"Error while saving image from URL {0}",url);
          t.printStackTrace(System.err);
        }
      }
      app.commitTx();
    }
  }
  finally {
    app.finishTx();
  }
}
