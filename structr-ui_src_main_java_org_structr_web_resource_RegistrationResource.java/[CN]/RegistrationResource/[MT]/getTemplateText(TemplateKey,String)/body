{
  try {
    List<SearchAttribute> attrs=new LinkedList();
    attrs.add(Search.andExactType(MailTemplate.class));
    attrs.add(Search.andExactName(key.name()));
    if (localeString != null) {
      attrs.add(Search.andExactProperty(securityContext,MailTemplate.locale,localeString));
    }
    List<MailTemplate> templates=(List<MailTemplate>)StructrApp.getInstance().command(SearchNodeCommand.class).execute(attrs).getResults();
    if (!templates.isEmpty()) {
      Content content=templates.get(0).getProperty(MailTemplate.text);
      return content != null ? content.getProperty(Content.content) : defaultValue;
    }
 else {
      return defaultValue;
    }
  }
 catch (  FrameworkException ex) {
    Logger.getLogger(RegistrationResource.class.getName()).log(Level.WARNING,"Could not get mail template for key " + key,ex);
  }
  return null;
}
