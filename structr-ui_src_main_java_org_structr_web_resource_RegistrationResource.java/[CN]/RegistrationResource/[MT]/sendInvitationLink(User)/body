{
  Map<String,String> replacementMap=new HashMap();
  String userEmail=user.getProperty(User.email);
  replacementMap.put(toPlaceholder(User.email.jsonName()),userEmail);
  replacementMap.put(toPlaceholder("link"),getTemplateText(TemplateKey.BASE_URL,"//" + Services.getApplicationHost() + ":"+ Services.getApplicationPort()) + "/" + HtmlServlet.CONFIRM_REGISTRATION_PAGE+ "?"+ HtmlServlet.CONFIRM_KEY_KEY+ "="+ confKey+ "&"+ HtmlServlet.TARGET_PAGE_KEY+ "="+ getTemplateText(TemplateKey.TARGET_PAGE,"register_thanks"));
  String textMailTemplate=getTemplateText(TemplateKey.TEXT_BODY,"Go to ${link} to finalize registration.");
  String htmlMailTemplate=getTemplateText(TemplateKey.HTML_BODY,"<div>Click <a href='${link}'>here</a> to finalize registration.</div>");
  String textMailContent=MailHelper.replacePlaceHoldersInTemplate(textMailTemplate,replacementMap);
  String htmlMailContent=MailHelper.replacePlaceHoldersInTemplate(htmlMailTemplate,replacementMap);
  try {
    MailHelper.sendHtmlMail(getTemplateText(TemplateKey.SENDER_ADDRESS,"structr-mail-daemon@localhost"),getTemplateText(TemplateKey.SENDER_NAME,"Structr Mail Daemon"),userEmail,"",null,null,null,getTemplateText(TemplateKey.SUBJECT,"Welcome to Structr, please finalize registration"),htmlMailContent,textMailContent);
  }
 catch (  Exception e) {
    logger.log(Level.SEVERE,"Unable to send registration e-mail",e);
  }
}
