{
  if (!securityContext.isVisible(file)) {
    response.sendError(HttpServletResponse.SC_NOT_FOUND);
    return;
  }
  ServletOutputStream out=response.getOutputStream();
  if (!EditMode.DATA.equals(edit) && notModifiedSince(request,response,file,false)) {
    out.flush();
    out.close();
  }
 else {
    InputStream in=file.getInputStream();
    String contentType=file.getContentType();
    if (contentType != null) {
      response.setContentType(contentType);
    }
 else {
      response.setContentType("application/octet-stream");
    }
    response.setStatus(HttpServletResponse.SC_OK);
    try {
      IOUtils.copy(in,out);
    }
 catch (    Throwable t) {
    }
 finally {
      if (out != null) {
        try {
          out.flush();
          out.close();
        }
 catch (        Throwable t) {
        }
      }
      if (in != null) {
        in.close();
      }
      response.setStatus(HttpServletResponse.SC_OK);
    }
  }
}
