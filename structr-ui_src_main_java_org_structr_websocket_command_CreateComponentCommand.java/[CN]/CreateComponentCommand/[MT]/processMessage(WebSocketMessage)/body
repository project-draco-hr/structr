{
  final SecurityContext securityContext=getWebSocket().getSecurityContext();
  final App app=StructrApp.getInstance(securityContext);
  String id=webSocketData.getId();
  if (id != null) {
    final DOMNode node=getDOMNode(id);
    try {
      app.beginTx();
      DOMNode clonedNode=(DOMNode)node.cloneNode(false);
      moveChildNodes(node,clonedNode);
      ShadowDocument hiddenDoc=getOrCreateHiddenDocument();
      clonedNode.setProperty(DOMNode.ownerDocument,hiddenDoc);
      for (      DOMNode child : DOMNode.getAllChildNodes(clonedNode)) {
        child.setProperty((DOMNode.ownerDocument),hiddenDoc);
      }
      app.create(node,clonedNode,Sync.class);
      app.create(clonedNode,node,Sync.class);
      app.commitTx();
    }
 catch (    Exception ex) {
      getWebSocket().send(MessageBuilder.status().code(422).message(ex.getMessage()).build(),true);
    }
 finally {
      app.finishTx();
    }
  }
 else {
    getWebSocket().send(MessageBuilder.status().code(422).message("Cannot append node without id").build(),true);
  }
}
