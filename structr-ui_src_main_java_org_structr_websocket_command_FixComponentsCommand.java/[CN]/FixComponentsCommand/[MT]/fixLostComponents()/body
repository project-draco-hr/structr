{
  Page hiddenDoc=getOrCreateHiddenDocument();
  SecurityContext securityContext=SecurityContext.getSuperUserInstance();
  Result<DOMNode> result=(Result<DOMNode>)StructrApp.getInstance(securityContext).command(SearchNodeCommand.class).execute(Search.andExactTypeAndSubtypes(DOMNode.class));
  final CreateRelationshipCommand createRel=StructrApp.getInstance(securityContext).command(CreateRelationshipCommand.class);
  for (  DOMNode node : result.getResults()) {
    if (node.hasChildNodes() && (node.hasIncomingRelationships(Sync.class) || node.hasRelationship(Sync.class)) && (!hiddenDoc.equals(node.getOwnerDocument()))) {
      try {
        DOMNode clonedNode=(DOMNode)node.cloneNode(false);
        moveChildNodes(node,clonedNode);
        clonedNode.setProperty(DOMNode.ownerDocument,hiddenDoc);
        createRel.execute(node,clonedNode,Sync.class);
        createRel.execute(clonedNode,node,Sync.class);
      }
 catch (      Exception ex) {
        logger.log(Level.SEVERE,"Could not fix component " + node,ex);
      }
    }
  }
}
