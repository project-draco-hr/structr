{
  final App app=StructrApp.getInstance(getWebSocket().getSecurityContext());
  try {
    app.beginTx();
switch (action) {
case "grant":
      principal.grant(Permission.valueOf(permission),obj);
    break;
case "revoke":
  principal.revoke(Permission.valueOf(permission),obj);
break;
}
app.commitTx();
}
  finally {
app.finishTx();
}
}
