{
  final App app=StructrApp.getInstance(getWebSocket().getSecurityContext());
  final Boolean recValue=(Boolean)webSocketData.getNodeData().get("recursive");
  final boolean rec=recValue != null ? recValue : false;
  GraphObject obj=getNode(webSocketData.getId());
  webSocketData.getNodeData().remove("recursive");
  if (obj != null) {
    try (final Tx tx=app.tx()){
      if (!getWebSocket().getSecurityContext().isAllowed(((AbstractNode)obj),Permission.write)) {
        getWebSocket().send(MessageBuilder.status().message("No write permission").code(400).build(),true);
        logger.log(Level.WARNING,"No write permission for {0} on {1}",new Object[]{getWebSocket().getCurrentUser().toString(),obj.toString()});
        tx.success();
        return;
      }
      tx.success();
    }
 catch (    FrameworkException fex) {
      fex.printStackTrace();
    }
  }
  if (obj == null) {
    obj=getRelationship(webSocketData.getId());
  }
  if (obj != null) {
    try {
      setProperties(app,obj,PropertyMap.inputTypeToJavaType(this.getWebSocket().getSecurityContext(),obj.getClass(),webSocketData.getNodeData()),rec);
      logger.log(Level.INFO,"Committing transaction after {0} objects..",count);
      tx.success();
      tx.close();
      tx=null;
    }
 catch (    FrameworkException ex) {
      logger.log(Level.SEVERE,"Unable to set properties: {0}",((FrameworkException)ex).toString());
      getWebSocket().send(MessageBuilder.status().code(400).build(),true);
    }
  }
 else {
    logger.log(Level.WARNING,"Graph object with uuid {0} not found.",webSocketData.getId());
    getWebSocket().send(MessageBuilder.status().code(404).build(),true);
  }
}
