{
  Services.command(getWebSocket().getSecurityContext(),TransactionCommand.class).execute(new StructrTransaction(){
    @Override public Object execute() throws FrameworkException {
      for (      Entry<PropertyKey,Object> entry : properties.entrySet()) {
        PropertyKey key=entry.getKey();
        Object value=entry.getValue();
        obj.setProperty(key,value);
        if (rec && obj instanceof AbstractNode) {
          AbstractNode node=(AbstractNode)obj;
          for (          AbstractRelationship rel : node.getOutgoingRelationships(RelType.CONTAINS)) {
            AbstractNode endNode=rel.getTargetNode();
            if (endNode != null) {
              setProperties(endNode,properties,rec);
            }
          }
        }
      }
      return null;
    }
  }
);
}
