{
  final SecurityContext securityContext=getWebSocket().getSecurityContext();
  final App app=StructrApp.getInstance(securityContext);
  try {
    app.beginTx();
    final String name=(String)webSocketData.getNodeData().get("name");
    final String rawData=(String)webSocketData.getNodeData().get("fileData");
    org.structr.web.entity.File newFile=FileHelper.createFileBase64(securityContext,rawData,null);
    newFile.setProperty(AbstractNode.name,name);
    app.commitTx();
  }
 catch (  Throwable t) {
    String msg=t.toString();
    getWebSocket().send(MessageBuilder.status().code(400).message("Could not upload file: ".concat((msg != null) ? msg : "")).build(),true);
  }
 finally {
    app.finishTx();
  }
}
