{
  return new MessageCallback<Message>(getUuid()){
    @Override public void onMessage(    final Message message){
      final App app=StructrApp.getInstance();
      try (final Tx tx=app.tx()){
        final XMPPClient client=getClient();
        if (client != null) {
          app.create(IncomingXMPPMessage.class,new NodeAttribute(IncomingXMPPMessage.sender,cleanXMPPUserName(message.getFrom())),new NodeAttribute(IncomingXMPPMessage.recipient,cleanXMPPUserName(message.getTo())),new NodeAttribute(IncomingXMPPMessage.text,message.getBody()),new NodeAttribute(IncomingXMPPMessage.owner,client.getProperty(AbstractNode.owner)));
        }
        tx.success();
      }
 catch (      FrameworkException fex) {
        fex.printStackTrace();
      }
    }
  }
;
}
