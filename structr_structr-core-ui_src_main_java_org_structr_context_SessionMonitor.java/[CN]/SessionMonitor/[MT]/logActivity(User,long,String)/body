{
  final Command transactionCommand=Services.createCommand(TransactionCommand.class);
  transactionCommand.execute(new StructrTransaction(){
    @Override public Object execute() throws Throwable {
      Command createNode=Services.createCommand(CreateNodeCommand.class);
      Date now=new Date();
      StructrNode s=(StructrNode)createNode.execute(user,new NodeAttribute(StructrNode.TYPE_KEY,Activity.class.getSimpleName()),new NodeAttribute(StructrNode.NAME_KEY,action + " (" + now+ ")"),new NodeAttribute(Activity.SESSION_ID_KEY,sessionId),new NodeAttribute(Activity.START_TIMESTAMP_KEY,now),new NodeAttribute(Activity.END_TIMESTAMP_KEY,now));
      Activity activity=new Activity();
      activity.init(s);
      getSession(sessionId).setLastActivity(activity);
      Services.createCommand(LogCommand.class).execute(activity);
      return null;
    }
  }
);
}
