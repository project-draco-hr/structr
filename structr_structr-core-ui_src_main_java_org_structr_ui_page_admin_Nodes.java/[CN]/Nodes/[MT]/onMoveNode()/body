{
  if (moveNodeForm.isValid()) {
    final String newParentNodeId=moveNodeForm.getFieldValue(NEW_PARENT_NODE_ID_KEY);
    final String sourceNodeId=StringUtils.isNotEmpty(moveNodeForm.getFieldValue(SOURCE_NODE_ID_KEY)) ? moveNodeForm.getFieldValue(SOURCE_NODE_ID_KEY) : getNodeId();
    Command transactionCommand=Services.command(TransactionCommand.class);
    transactionCommand.execute(new StructrTransaction(){
      @Override public Object execute() throws Throwable {
        Command moveNode=Services.command(MoveNodeCommand.class);
        moveNode.execute(sourceNodeId,newParentNodeId);
        return (null);
      }
    }
);
    okMsg="Node moved to " + newParentNodeId + ".";
    Map<String,String> parameters=new HashMap<String,String>();
    parameters.put(NODE_ID_KEY,String.valueOf(getNodeId()));
    parameters.put(RENDER_MODE_KEY,renderMode);
    parameters.put(OK_MSG_KEY,okMsg);
    setRedirect(getRedirectPage(node),parameters);
  }
  if (!moveNodeForm.isValid()) {
    moveNodeFormIsInvalid="true";
    return true;
  }
  return false;
}
