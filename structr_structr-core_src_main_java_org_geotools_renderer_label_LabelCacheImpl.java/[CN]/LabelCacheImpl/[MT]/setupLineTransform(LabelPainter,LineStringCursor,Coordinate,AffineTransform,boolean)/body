{
  tempTransform.translate(centroid.x,centroid.y);
  TextStyle2D textStyle=painter.getLabel().getTextStyle();
  double anchorX=textStyle.getAnchorX();
  double anchorY=textStyle.getAnchorY();
  double rotation;
  double displacementX=0;
  double displacementY=0;
  if (textStyle.isPointPlacement() && !followLine) {
    rotation=textStyle.getRotation();
  }
 else {
    if (painter.getLabel().isForceLeftToRightEnabled()) {
      rotation=cursor.getLabelOrientation();
    }
 else {
      rotation=cursor.getCurrentAngle();
    }
    displacementY-=textStyle.getPerpendicularOffset();
    anchorX=0.5;
    anchorY=painter.getLinePlacementYAnchor();
  }
  Rectangle2D textBounds=painter.getLabelBounds();
  displacementX=(anchorX * (-textBounds.getWidth())) + textStyle.getDisplacementX();
  displacementY+=(anchorY * (textBounds.getHeight())) - textStyle.getDisplacementY();
  if (Double.isNaN(rotation) || Double.isInfinite(rotation))   rotation=0.0;
  tempTransform.rotate(rotation);
  tempTransform.translate(displacementX,displacementY);
}
