{
  Rectangle2D boundsShape=shape.getBounds2D();
  Rectangle2D stippleSize=null;
  if (graphicFill instanceof MarkStyle2D) {
    Rectangle2D boundsFill=((MarkStyle2D)graphicFill).getShape().getBounds2D();
    double size=((MarkStyle2D)graphicFill).getSize();
    double aspect=(boundsFill.getHeight() > 0 && boundsFill.getWidth() > 0) ? boundsFill.getWidth() / boundsFill.getHeight() : 1.0;
    stippleSize=new Rectangle2D.Double(0,0,size * aspect,size);
  }
 else   if (graphicFill instanceof IconStyle2D) {
    Icon icon=((IconStyle2D)graphicFill).getIcon();
    stippleSize=new Rectangle2D.Double(0,0,icon.getIconWidth(),icon.getIconHeight());
  }
 else {
    return;
  }
  int toX=(int)Math.ceil(boundsShape.getWidth() / stippleSize.getWidth());
  int toY=(int)Math.ceil(boundsShape.getHeight() / stippleSize.getHeight());
  Graphics2D g=(Graphics2D)graphics.create();
  g.clip(shape);
  Shape clipShape=g.getClip();
  Rectangle2D boundsClip=clipShape.getBounds2D();
  int fromX=0;
  if (boundsClip.getMinX() > boundsShape.getMinX()) {
    fromX=(int)Math.floor((boundsClip.getMinX() - boundsShape.getMinX()) / stippleSize.getWidth());
  }
  if (boundsClip.getMaxX() < boundsShape.getMaxX()) {
    toX-=(int)Math.floor((boundsShape.getMaxX() - boundsClip.getMaxX()) / stippleSize.getWidth());
  }
  int fromY=0;
  if (boundsClip.getMinY() > boundsShape.getMinY()) {
    fromY=(int)Math.floor((boundsClip.getMinY() - boundsShape.getMinY()) / stippleSize.getHeight());
  }
  if (boundsClip.getMaxY() < boundsShape.getMaxY()) {
    toY-=(int)Math.floor((boundsShape.getMaxY() - boundsClip.getMaxY()) / stippleSize.getHeight());
  }
  for (int i=fromX; i < toX; i++) {
    for (int j=fromY; j < toY; j++) {
      double translateX=boundsShape.getMinX() + i * stippleSize.getWidth();
      double translateY=boundsShape.getMinY() + j * stippleSize.getHeight();
      if (!clipShape.intersects(translateX,translateY,stippleSize.getWidth(),stippleSize.getHeight()))       continue;
      MetaDataShape stippleShape=createStippleShape(stippleSize,translateX,translateY);
      paint(g,stippleShape,graphicFill,scale);
    }
  }
}
