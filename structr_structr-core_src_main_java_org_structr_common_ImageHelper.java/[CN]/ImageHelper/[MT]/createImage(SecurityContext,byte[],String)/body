{
  Command createNodeCommand=Services.command(securityContext,CreateNodeCommand.class);
  Map<String,Object> props=new HashMap();
  props.put(AbstractNode.Key.type.name(),Image.class.getSimpleName());
  props.put(File.Key.contentType.name(),contentType);
  Image newImage=(Image)createNodeCommand.execute(props);
  String uuid=newImage.getStringProperty(AbstractNode.Key.uuid);
  newImage.setRelativeFilePath(File.getDirectoryPath(uuid) + "/" + uuid);
  java.io.File fileOnDisk=new java.io.File(Services.getFilesPath() + "/" + newImage.getRelativeFilePath());
  fileOnDisk.getParentFile().mkdirs();
  FileUtils.writeByteArrayToFile(fileOnDisk,imageData);
  return newImage;
}
