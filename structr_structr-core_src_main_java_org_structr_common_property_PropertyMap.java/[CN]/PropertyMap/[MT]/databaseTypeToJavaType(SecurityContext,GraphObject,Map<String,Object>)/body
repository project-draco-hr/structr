{
  PropertyMap resultMap=new PropertyMap();
  Class entityType=entity.getClass();
  if (source != null) {
    for (    Entry<String,Object> entry : source.entrySet()) {
      String key=entry.getKey();
      Object value=entry.getValue();
      if (key != null) {
        PropertyKey propertyKey=EntityContext.getPropertyKeyForName(entityType,key);
        PropertyConverter converter=propertyKey.databaseConverter(securityContext,entity);
        if (converter != null) {
          try {
            Object propertyValue=converter.revert(value);
            resultMap.put(propertyKey,propertyValue);
          }
 catch (          ClassCastException cce) {
            cce.printStackTrace();
            throw new FrameworkException(entityType.getSimpleName(),new TypeToken(propertyKey,"XXX"));
          }
        }
 else {
          resultMap.put(propertyKey,value);
        }
      }
    }
  }
  return resultMap;
}
