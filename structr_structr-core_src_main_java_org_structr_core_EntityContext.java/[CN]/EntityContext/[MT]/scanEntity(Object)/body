{
  Map<Field,PropertyKey> allProperties=getFieldValuesOfType(PropertyKey.class,entity);
  Map<Field,View> views=getFieldValuesOfType(View.class,entity);
  Class entityType=entity.getClass();
  for (  Entry<Field,PropertyKey> entry : allProperties.entrySet()) {
    PropertyKey propertyKey=entry.getValue();
    Field field=entry.getKey();
    Class declaringClass=field.getDeclaringClass();
    if (declaringClass != null) {
      propertyKey.setDeclaringClass(declaringClass);
      registerProperty(declaringClass,propertyKey);
    }
    registerProperty(entityType,propertyKey);
  }
  for (  Entry<Field,View> entry : views.entrySet()) {
    Field field=entry.getKey();
    View view=entry.getValue();
    for (    PropertyKey propertyKey : view.properties()) {
      registerPropertySet(field.getDeclaringClass(),view.name(),propertyKey);
      registerPropertySet(entityType,view.name(),propertyKey);
    }
  }
}
