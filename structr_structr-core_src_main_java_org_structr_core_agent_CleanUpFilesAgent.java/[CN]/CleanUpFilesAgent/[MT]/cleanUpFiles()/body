{
  File filesFolder=new File(Services.getFilesPath());
  File[] files=filesFolder.listFiles();
  long count=0;
  final SecurityContext securityContext=SecurityContext.getSuperUserInstance();
  try {
    Command graphDbCommand=Services.command(securityContext,GraphDatabaseCommand.class);
    GraphDatabaseService graphDb=(GraphDatabaseService)graphDbCommand.execute();
    for (    File file : files) {
      String fileName=file.getName();
      String[] parts=StringUtils.split(fileName,"_");
      String nodeId=parts[0];
      long id=Long.parseLong(nodeId);
      try {
        graphDb.getNodeById(id);
      }
 catch (      NotFoundException nfe) {
        logger.log(Level.INFO,"Removing unreferenced file {0})",fileName);
        file.delete();
        count++;
      }
    }
  }
 catch (  FrameworkException fex) {
    fex.printStackTrace();
  }
  return count;
}
