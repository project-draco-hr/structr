{
  Command transactionCommand=Services.command(TransactionCommand.class);
  Long numberOfImages=(Long)transactionCommand.execute(new StructrTransaction(){
    @Override public Object execute() throws Throwable {
      List<Image> images=new LinkedList<Image>();
      List<StructrNode> allNodes=(List<StructrNode>)Services.command(GetAllNodes.class).execute();
      for (      StructrNode s : allNodes) {
        if (s instanceof Image) {
          images.add((Image)s);
        }
      }
      Services.command(ExtractAndSetImageDimensionsAndFormat.class).execute(images);
      return images.size();
    }
  }
);
  return numberOfImages;
}
