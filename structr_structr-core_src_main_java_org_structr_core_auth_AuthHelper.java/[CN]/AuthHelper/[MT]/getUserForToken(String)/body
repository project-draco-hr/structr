{
  Principal user=null;
  List<SearchAttribute> attrs=new LinkedList<SearchAttribute>();
  attrs.add(Search.andExactProperty(Principal.Key.sessionId,messageToken));
  attrs.add(Search.andExactType("User"));
  try {
    List<AbstractNode> results=(List<AbstractNode>)Services.command(SecurityContext.getSuperUserInstance(),SearchNodeCommand.class).execute(null,false,false,attrs);
    if (!results.isEmpty()) {
      user=(Principal)results.get(0);
      if ((user != null) && messageToken.equals(user.getProperty(Principal.Key.sessionId))) {
        return user;
      }
    }
  }
 catch (  FrameworkException fex) {
    logger.log(Level.WARNING,"Error while executing SearchNodeCommand",fex);
  }
  return user;
}
