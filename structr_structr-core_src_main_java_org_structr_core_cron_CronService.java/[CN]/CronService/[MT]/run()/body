{
  while (doRun) {
    try {
      CronEntry entry=cronEntries.poll(GRANULARITY,GRANULARITY_UNIT);
      if (entry != null) {
        String taskClassName=entry.getName();
        try {
          Class taskClass=Class.forName(taskClassName);
          Task task=(Task)taskClass.newInstance();
          logger.log(Level.FINE,"Starting task {0}",taskClassName);
          Services.command(securityContext,ProcessTaskCommand.class).execute(task);
          cronEntries.add(entry);
          logger.log(Level.FINEST,"Task {0} re-inserted, queue now contains {1} entries.",new Object[]{taskClassName,cronEntries.size()});
          Thread.sleep(GRANULARITY_UNIT.toMillis(GRANULARITY));
        }
 catch (        Throwable t) {
          logger.log(Level.WARNING,"Could not start task {0}: {1}",new Object[]{taskClassName,t.getMessage()});
        }
      }
 else {
        logger.log(Level.FINE,"No entry available in queue, queue size: {0}",cronEntries.size());
        CronEntry e=cronEntries.peek();
        if (e != null) {
          logger.log(Level.FINEST,"Expiry of next entry: {0}",e.getDelay(TimeUnit.MILLISECONDS));
        }
      }
    }
 catch (    InterruptedException irex) {
    }
  }
}
