{
  if (principal == null) {
    return false;
  }
  if (permission == null) {
    return false;
  }
  if (principal instanceof SuperUser) {
    return true;
  }
  if (this.equals(principal)) {
    return true;
  }
  AbstractRelationship r=getSecurityRelationship(principal);
  if ((r != null) && r.isAllowed(permission)) {
    return true;
  }
  List<AbstractRelationship> rels=principal.getIncomingChildRelationships();
  for (  AbstractRelationship sr : rels) {
    AbstractNode node=sr.getStartNode();
    if (!(node instanceof Group)) {
      continue;
    }
    Group group=(Group)node;
    r=getSecurityRelationship(group);
    if ((r != null) && r.isAllowed(permission)) {
      return true;
    }
  }
  return false;
}
