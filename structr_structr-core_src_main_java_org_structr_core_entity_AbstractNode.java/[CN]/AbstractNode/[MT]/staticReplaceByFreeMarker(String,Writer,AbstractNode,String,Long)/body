{
  Configuration cfg=new Configuration();
  try {
    AbstractNode callingNode=null;
    if (templateString != null) {
      Map root=new HashMap();
      root.put("Template",node);
      if (callingNode != null) {
        root.put(callingNode.getType(),callingNode);
      }
      HttpServletRequest request=CurrentRequest.getRequest();
      if (request != null) {
        root.put("Request",new freemarker.ext.servlet.HttpRequestParametersHashModel(request));
        String searchString=request.getParameter("search");
        if ((searchString != null) && !(searchString.isEmpty())) {
          Command search=Services.command(SearchNodeCommand.class);
          List<AbstractNode> result=(List<AbstractNode>)search.execute(null,null,false,true,Search.orName(searchString));
          root.put("SearchResults",result);
        }
      }
      root.put("User",CurrentRequest.getCurrentUser());
      root.put("Helper",new TemplateHelper());
      HttpSession session=CurrentRequest.getSession();
      if (session != null) {
        if (session.getAttribute("errorMessage") != null) {
          root.put("ErrorMessage",session.getAttribute("errorMessage"));
        }
        if (session.getAttribute("errorMessage") != null) {
          root.put("OkMessage",session.getAttribute("okMessage"));
        }
      }
      freemarker.template.Template t=new freemarker.template.Template(node.getName(),new StringReader(templateString),cfg);
      t.process(root,out);
    }
 else {
      out.write(templateString);
      out.flush();
    }
  }
 catch (  Throwable t) {
    logger.log(Level.WARNING,"Error: {0}",t.getMessage());
  }
}
