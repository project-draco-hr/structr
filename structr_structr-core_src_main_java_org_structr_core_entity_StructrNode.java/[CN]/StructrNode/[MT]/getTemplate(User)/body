{
  long t0=System.currentTimeMillis();
  if (this instanceof Template) {
    template=(Template)this;
    return template;
  }
  if (template != null) {
    logger.log(Level.FINE,"Cached template found");
    return template;
  }
  StructrNode startNode=this;
  while (startNode != null && !(startNode.isRootNode())) {
    List<StructrRelationship> templateRelationships=startNode.getRelationships(RelType.USE_TEMPLATE,Direction.OUTGOING);
    if (templateRelationships != null && !(templateRelationships.isEmpty())) {
      template=(Template)templateRelationships.get(0).getEndNode();
      return template;
    }
    if (template == null) {
      startNode=startNode.getParentNode(user);
      continue;
    }
  }
  long t1=System.currentTimeMillis();
  logger.log(Level.FINE,"No template found in {0} ms",(t1 - t0));
  return null;
}
