{
  Command transaction=Services.command(TransactionCommand.class);
  transaction.execute(new StructrTransaction(){
    @Override public Object execute() throws Throwable {
      Command findNode=Services.command(FindNodeCommand.class);
      Command deleteRel=Services.command(DeleteRelationshipCommand.class);
      Command createRel=Services.command(CreateRelationshipCommand.class);
      Command nodeFactory=Services.command(NodeFactoryCommand.class);
      StructrNode startNode=(StructrNode)nodeFactory.execute(getStartNode());
      StructrNode newEndNode=(StructrNode)findNode.execute(user,endNodeId);
      if (newEndNode != null) {
        RelationshipType type=dbRelationship.getType();
        deleteRel.execute(dbRelationship);
        dbRelationship=((StructrRelationship)createRel.execute(type,startNode,newEndNode)).getRelationship();
      }
      return (null);
    }
  }
);
}
