{
  Envelope localEnv=null;
  if (layerName.equals(layer.getName())) {
    localEnv=env;
  }
 else {
    localEnv=getEnvelope(layerName,propertyKey,getName());
  }
  if (localEnv != null) {
    Search searchQuery=new SearchIntersectWindow(localEnv);
    spatialIndex.executeSearch(searchQuery);
    List<SpatialDatabaseRecord> results=searchQuery.getResults();
    List<Geometry> result=new ArrayList<Geometry>();
    for (    SpatialDatabaseRecord r : results) {
      result.add(r.getGeometry());
    }
    return (Geometry[])result.toArray(new Geometry[result.size()]);
  }
 else {
    logger.log(Level.SEVERE,"No envelope found");
  }
  return null;
}
