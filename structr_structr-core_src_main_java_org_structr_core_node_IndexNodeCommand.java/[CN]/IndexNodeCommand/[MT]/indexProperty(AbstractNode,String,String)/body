{
  Node dbNode=node.getNode();
  long id=node.getId();
  if (key == null) {
    logger.log(Level.SEVERE,"Node {0} has null key",new Object[]{id});
    return;
  }
  boolean emptyKey=StringUtils.isEmpty((String)key);
  if (emptyKey) {
    logger.log(Level.SEVERE,"Node {0} has empty, not-null key, removing property",new Object[]{id});
    dbNode.removeProperty(key);
    return;
  }
  Object value=node.getProperty(key);
  Object valueForIndexing=node.getPropertyForIndexing(key);
  if ((value == null && EntityContext.getPropertyConverter(securityContext,node.getClass(),key) == null) || (value != null && value instanceof String && StringUtils.isEmpty((String)value))) {
    valueForIndexing=SearchNodeCommand.IMPROBABLE_SEARCH_VALUE;
    value=SearchNodeCommand.IMPROBABLE_SEARCH_VALUE;
  }
  logger.log(Level.FINE,"Indexing value {0} for key {1} on node {2} in {3} index",new Object[]{valueForIndexing,key,id,indexName});
  removeNodePropertyFromIndex(dbNode,key,indexName);
  logger.log(Level.FINE,"Node {0}: Old value for key {1} removed from {2} index",new Object[]{id,key,indexName});
  addNodePropertyToIndex(dbNode,key,valueForIndexing,indexName);
  if ((node instanceof Principal) && (key.equals(AbstractNode.Key.name.name()) || key.equals(Person.Key.email.name()))) {
    removeNodePropertyFromIndex(dbNode,key,NodeIndex.user.name());
    addNodePropertyToIndex(dbNode,key,valueForIndexing,NodeIndex.user.name());
  }
  if (key.equals(AbstractNode.Key.uuid.name())) {
    removeNodePropertyFromIndex(dbNode,key,NodeIndex.uuid.name());
    addNodePropertyToIndex(dbNode,key,valueForIndexing,NodeIndex.uuid.name());
  }
  logger.log(Level.FINE,"Node {0}: New value {2} added for key {1}",new Object[]{id,key,value});
}
