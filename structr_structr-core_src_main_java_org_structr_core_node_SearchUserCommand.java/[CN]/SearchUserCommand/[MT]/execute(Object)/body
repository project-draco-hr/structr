{
  GraphDatabaseService graphDb=(GraphDatabaseService)arguments.get("graphDb");
  LuceneFulltextIndexService index=(LuceneFulltextIndexService)arguments.get("index");
  Command findNode=Services.command(FindNodeCommand.class);
  if (graphDb != null) {
switch (parameters.length) {
case 1:
      if (parameters[0] instanceof String) {
        String userName=(String)parameters[0];
        for (        Node n : index.getNodes(StructrNode.NAME_KEY,userName)) {
          StructrNode s=(StructrNode)findNode.execute(n);
          if (s.getType().equals("User")) {
            return s;
          }
        }
      }
    break;
case 2:
  if (parameters[0] instanceof String && parameters[1] instanceof String) {
    String userName=(String)parameters[0];
    String rootNodePath=(String)parameters[1];
    List<StructrNode> nodes=(List<StructrNode>)findNode.execute(new XPath(rootNodePath));
    if (nodes != null && nodes.size() > 0) {
      StructrNode r=nodes.get(0);
      Node startNode=null;
      if (r != null) {
        startNode=r.getNode();
        if (startNode != null) {
          startNode=graphDb.getReferenceNode();
        }
        for (        Node n : getSubnodes(startNode)) {
          StructrNode s=(StructrNode)findNode.execute(n);
          if (s.getType().equals("User") && userName.equals(s.getName())) {
            return s;
          }
        }
      }
    }
  }
break;
default :
break;
}
}
return null;
}
