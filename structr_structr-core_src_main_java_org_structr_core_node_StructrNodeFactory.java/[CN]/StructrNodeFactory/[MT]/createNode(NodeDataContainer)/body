{
  if (data == null) {
    logger.log(Level.SEVERE,"Could not create node: Empty data container.");
    return null;
  }
  Map properties=data.getProperties();
  String nodeType=properties.containsKey(AbstractNode.TYPE_KEY) ? (String)properties.get(AbstractNode.TYPE_KEY) : null;
  Class nodeClass=(Class)Services.command(GetEntityClassCommand.class).execute(nodeType);
  AbstractNode newNode=null;
  if (nodeClass != null) {
    try {
      newNode=(AbstractNode)nodeClass.newInstance();
    }
 catch (    Throwable t) {
      newNode=null;
    }
  }
  if (newNode == null) {
    newNode=new EmptyNode();
  }
  newNode.init(data);
  newNode.commit(null);
  if (data instanceof FileNodeDataContainer) {
    byte[] binaryContent=((FileNodeDataContainer)data).getBinaryContent();
    if (binaryContent != null) {
      File fileNode=(File)newNode;
      String relativeFilePath=newNode.getId() + "_" + System.currentTimeMillis();
      String path=Services.getFilesPath() + "/" + relativeFilePath;
      long size=binaryContent.length;
      java.io.File fileOnDisk=new java.io.File(path);
      try {
        FileUtils.writeByteArrayToFile(fileOnDisk,binaryContent);
        fileNode.setSize(size);
        fileNode.setRelativeFilePath(relativeFilePath);
      }
 catch (      Exception e) {
        logger.log(Level.SEVERE,"Could not write file",e);
      }
    }
  }
  return newNode;
}
