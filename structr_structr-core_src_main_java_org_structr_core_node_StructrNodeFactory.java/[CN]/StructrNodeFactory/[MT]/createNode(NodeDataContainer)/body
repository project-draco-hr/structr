{
  if (data == null) {
    logger.log(Level.SEVERE,"Could not create node: Empty data container.");
    return null;
  }
  Map properties=data.getProperties();
  String nodeType=properties.containsKey(AbstractNode.TYPE_KEY) ? (String)properties.get(AbstractNode.TYPE_KEY) : null;
  Class nodeClass=(Class)Services.command(GetEntityClassCommand.class).execute(nodeType);
  AbstractNode newNode=null;
  if (nodeClass != null) {
    try {
      newNode=(AbstractNode)nodeClass.newInstance();
    }
 catch (    Throwable t) {
      newNode=null;
    }
  }
  if (newNode == null) {
    newNode=new ArbitraryNode();
  }
  newNode.init(data);
  newNode.commit(null);
  newNode.onNodeInstantiation();
  if (data instanceof FileNodeDataContainer) {
    FileNodeDataContainer container=(FileNodeDataContainer)data;
    File fileNode=(File)newNode;
    String relativeFilePath=newNode.getId() + "_" + System.currentTimeMillis();
    String path=Services.getFilesPath() + "/" + relativeFilePath;
    if (container.persistTemporaryFile(path)) {
      fileNode.setSize(container.getFileSize());
      fileNode.setRelativeFilePath(relativeFilePath);
    }
  }
  return newNode;
}
