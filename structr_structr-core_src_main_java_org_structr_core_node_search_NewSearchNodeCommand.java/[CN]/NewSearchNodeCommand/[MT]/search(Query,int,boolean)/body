{
  GraphDatabaseService graphDb=(GraphDatabaseService)arguments.get("graphDb");
  if (graphDb != null) {
    Index<Node> fulltextIndex=(Index<Node>)arguments.get("index");
    Index<Node> exactIndex=(Index<Node>)arguments.get("exactIndex");
    NodeFactory nodeFactory=(NodeFactory)arguments.get("nodeFactory");
    List<AbstractNode> finalResult=new LinkedList<AbstractNode>();
    QueryContext queryContext=new QueryContext(query);
    queryContext.sort(AbstractNode.Key.name.name());
    if (desiredResultCount > 0) {
      queryContext.top(desiredResultCount);
    }
    logger.log(Level.INFO,"Querying {0} index with {1}",new Object[]{strict ? "exact" : "fulltext",query.toString()});
    IndexHits<Node> hits=strict ? exactIndex.query(queryContext) : fulltextIndex.query(queryContext);
    for (    Node node : hits) {
      finalResult.add(nodeFactory.createNode(securityContext,node));
    }
    logger.log(Level.INFO,"{0} results",finalResult.size());
    return finalResult;
  }
  return Collections.emptyList();
}
