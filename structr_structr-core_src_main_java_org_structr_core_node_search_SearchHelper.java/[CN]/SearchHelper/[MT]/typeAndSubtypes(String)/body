{
  Map<String,Class> entities=Services.command(SecurityContext.getSuperUserInstance(),GetEntitiesCommand.class).execute();
  Class parentClass=entities.get(StringUtils.capitalize(type));
  BooleanQuery query=new BooleanQuery();
  if (parentClass == null) {
    return type(type);
  }
  for (  Map.Entry<String,Class> entity : entities.entrySet()) {
    Class entityClass=entity.getValue();
    if (parentClass.isAssignableFrom(entityClass)) {
      query.add(type(entity.getKey()),Occur.SHOULD);
    }
  }
  return query;
}
