{
  CurrentRequest.setAccessMode(AccessMode.Frontend);
  try {
    double queryTimeStart=System.nanoTime();
    Result result=getResults(request);
    double queryTimeEnd=System.nanoTime();
    if (result != null) {
      DecimalFormat decimalFormat=new DecimalFormat("0.000000000",DecimalFormatSymbols.getInstance(Locale.ENGLISH));
      result.setQueryTime(decimalFormat.format((queryTimeEnd - queryTimeStart) / 1000000000.0));
      response.setContentType("application/json; charset=utf-8");
      Writer writer=response.getWriter();
      int mode=parseInt(request.getParameter("mode"),0);
switch (mode) {
case 0:
        gsonAdapter.setOutputMode(GraphObjectGSONAdapter.OutputMode.NestedKeyValueType);
      break;
case 1:
    gsonAdapter.setOutputMode(GraphObjectGSONAdapter.OutputMode.NestedKeyValue);
  break;
case 2:
gsonAdapter.setOutputMode(GraphObjectGSONAdapter.OutputMode.FlatNameValue);
break;
}
gson.toJson(result,writer);
writer.flush();
writer.close();
response.setStatus(HttpServletResponse.SC_OK);
}
 else {
response.setStatus(HttpServletResponse.SC_NO_CONTENT);
}
}
 catch (PathException pex) {
response.setStatus(pex.getStatus());
}
catch (Throwable t) {
logger.log(Level.WARNING,"Exception",t);
}
}
