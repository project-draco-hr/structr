{
  List<? extends GraphObject> results;
  try {
    results=doGet(listeners);
  }
 catch (  NoResultsException nre) {
    results=null;
  }
  if (results != null && !results.isEmpty()) {
    final List<? extends GraphObject> finalResults=results;
    Services.command(securityContext,TransactionCommand.class).execute(new StructrTransaction(){
      @Override public Object execute() throws Throwable {
        ErrorBuffer errorBuffer=new ErrorBuffer();
        boolean success=true;
        for (        GraphObject obj : finalResults) {
          if (mayDelete(listeners,obj,errorBuffer)) {
            if (obj instanceof AbstractNode) {
              List<StructrRelationship> rels=((AbstractNode)obj).getRelationships();
              for (              StructrRelationship rel : rels) {
                success&=rel.delete();
              }
            }
            success&=obj.delete();
          }
        }
        if (!success) {
          throw new IllegalArgumentException(errorBuffer.toString());
        }
        return success;
      }
    }
);
  }
  return new RestMethodResult(HttpServletResponse.SC_OK);
}
