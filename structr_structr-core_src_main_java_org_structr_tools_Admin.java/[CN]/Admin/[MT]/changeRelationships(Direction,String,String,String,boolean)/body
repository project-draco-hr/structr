{
  RelationshipType oldRelType=DynamicRelationshipType.withName(oldType);
  RelationshipType newRelType=DynamicRelationshipType.withName(newType);
  Iterable<Node> allNodes=graphDb.getAllNodes();
  for (  Node n : allNodes) {
    if (n.hasProperty(StructrNode.TYPE_KEY) && n.getProperty(StructrNode.TYPE_KEY).equals(nodeType)) {
      System.out.println(nodeType + " node found: " + n.getId());
      for (      Relationship rel : n.getRelationships(oldRelType,relDirection)) {
        System.out.println("Relationship found: " + rel);
        Node startNode=null;
        Node endNode=null;
        if (relDirection.equals(Direction.OUTGOING)) {
          startNode=n;
          endNode=rel.getEndNode();
        }
 else {
          startNode=rel.getStartNode();
          endNode=n;
        }
        Relationship newRel=null;
        if (!test) {
          newRel=startNode.createRelationshipTo(endNode,newRelType);
        }
        System.out.println("New relationship created: " + newRel);
        if (!test) {
          rel.delete();
        }
        System.out.println("Old relationship deleted: " + rel);
      }
    }
  }
}
