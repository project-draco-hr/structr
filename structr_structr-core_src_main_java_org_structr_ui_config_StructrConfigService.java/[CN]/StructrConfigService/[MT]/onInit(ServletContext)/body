{
  Validate.notNull(servletContext,"Null servletContext parameter");
  this.servletContext=servletContext;
  onGoogleAppEngine=servletContext.getServerInfo().startsWith(GOOGLE_APP_ENGINE);
  logService=new ConsoleLogService();
  messagesMapService=new DefaultMessagesMapService();
  InputStream inputStream=ClickUtils.getClickConfig(servletContext);
  try {
    Document document=ClickUtils.buildDocument(inputStream,this);
    SecurityContext securityContext=SecurityContext.getSuperUserInstance();
    Services.command(securityContext,ExtendConfigCommand.class).execute(document);
    Element rootElm=document.getDocumentElement();
    loadLogService(rootElm);
    loadMode(rootElm);
    if (logService.isInfoEnabled()) {
      logService.info("***  Initializing Click " + ClickUtils.getClickVersion() + " in "+ getApplicationMode()+ " mode  ***");
      String msg="initialized LogService: " + logService.getClass().getName();
      getLogService().info(msg);
    }
    deployFiles(rootElm);
    loadFormatClass(rootElm);
    loadHeaders(rootElm);
    loadPages(rootElm);
    loadDefaultPages();
    loadCharset(rootElm);
    loadLocale(rootElm);
    loadFileUploadService(rootElm);
    loadTemplateService(rootElm);
    loadResourceService(rootElm);
    loadMessagesMapService(rootElm);
    loadPageInterceptors(rootElm);
  }
  finally {
    ClickUtils.close(inputStream);
  }
}
