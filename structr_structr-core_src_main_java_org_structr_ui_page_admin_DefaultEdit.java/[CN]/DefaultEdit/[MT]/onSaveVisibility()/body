{
  if (editVisibilityForm.isValid()) {
    final TransactionCommand transactionCommand=(TransactionCommand)Services.command(TransactionCommand.class);
    StructrTransaction transaction=new StructrTransaction(){
      @Override public Object execute() throws Throwable {
        AbstractNode s=getNodeByIdOrPath(getNodeId());
        if (editVisibilityForm.isValid()) {
          editVisibilityForm.copyTo(s,true);
          transactionCommand.setExitCode(Command.exitCode.SUCCESS);
        }
 else {
          transactionCommand.setExitCode(Command.exitCode.FAILURE);
          transactionCommand.setErrorMessage("Visibility form is invalid");
        }
        return (null);
      }
    }
;
    transactionCommand.execute(transaction);
    if (transaction.getCause() != null) {
      okMsg=transaction.getCause().getMessage();
    }
 else {
      okMsg="Node visibility parameter successfully saved.";
    }
    Map<String,String> parameters=new HashMap<String,String>();
    parameters.put(NODE_ID_KEY,nodeId.toString());
    setRedirect(getPath(),parameters);
    return false;
  }
 else {
    return true;
  }
}
