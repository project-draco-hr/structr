{
  if (copyNodeForm.isValid()) {
    final String targetNodeId=copyNodeForm.getFieldValue(TARGET_NODE_ID_KEY);
    final String sourceNodeId=StringUtils.isNotEmpty(copyNodeForm.getFieldValue(SOURCE_NODE_ID_KEY)) ? copyNodeForm.getFieldValue(SOURCE_NODE_ID_KEY) : getNodeId();
    Command transactionCommand=Services.command(TransactionCommand.class);
    transactionCommand.execute(new StructrTransaction(){
      @Override public Object execute() throws Throwable {
        Command copyNode=Services.command(CopyNodeCommand.class);
        copyNode.execute(sourceNodeId,targetNodeId,user);
        return (null);
      }
    }
);
    okMsg="Node copied to " + targetNodeId + ".";
    Services.command(AddNotificationCommand.class).execute(new SuccessNotification(okMsg));
    Map<String,String> parameters=new HashMap<String,String>();
    parameters.put(NODE_ID_KEY,String.valueOf(getNodeId()));
    parameters.put(RENDER_MODE_KEY,renderMode);
    parameters.put(OK_MSG_KEY,okMsg);
    setRedirect(getRedirectPage(node),parameters);
  }
  if (!copyNodeForm.isValid()) {
    copyNodeFormIsInvalid="true";
    return true;
  }
  return false;
}
