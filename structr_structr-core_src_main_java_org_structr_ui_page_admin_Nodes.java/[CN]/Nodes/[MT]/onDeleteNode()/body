{
  if (deleteNodeForm.isValid()) {
    final String parent=deleteNodeForm.getFieldValue(PARENT_NODE_ID_KEY);
    final String recursive=deleteNodeForm.getFieldValue(RECURSIVE_KEY);
    final User user=securityContext.getUser();
    AbstractNode parentNode=null;
    try {
      final Command transactionCommand=Services.command(TransactionCommand.class);
      parentNode=(AbstractNode)transactionCommand.execute(new StructrTransaction(){
        @Override public Object execute() throws Throwable {
          Command deleteNode=Services.command(DeleteNodeCommand.class);
          Object result=deleteNode.execute(getNodeId(),parent,recursive,user);
          transactionCommand.setExitCode(deleteNode.getExitCode());
          transactionCommand.setErrorMessage(deleteNode.getErrorMessage());
          return result;
        }
      }
);
      Map<String,String> parameters=new HashMap<String,String>();
      parameters.put(RENDER_MODE_KEY,renderMode);
      if (Command.exitCode.SUCCESS.equals(transactionCommand.getExitCode())) {
        removeTreeNode(getNodeId().toString());
        errorMsg=null;
        okMsg="Node " + getNodeId() + " successfully deleted";
        parameters.put(OK_MSG_KEY,okMsg);
      }
 else {
        okMsg=null;
        errorMsg=transactionCommand.getErrorMessage();
        parameters.put(ERROR_MSG_KEY,errorMsg);
      }
      if (parentNode != null) {
        parameters.put(NODE_ID_KEY,String.valueOf(parentNode.getId()));
        setRedirect(getRedirectPage(parentNode),parameters);
      }
    }
 catch (    Exception e) {
      logger.log(Level.WARNING,"Node {0} could not be deleted.",getNodeId());
      okMsg=null;
      errorMsg="Node " + getNodeId() + " could not be deleted. "+ e.getMessage();
      Services.command(AddNotificationCommand.class).execute(new ErrorNotification(securityContext,errorMsg));
      return true;
    }
  }
  if (!deleteNodeForm.isValid()) {
    deleteNodeFormIsInvalid="true";
    return true;
  }
  return false;
}
