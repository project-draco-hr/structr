{
  if (extractNodeForm.isValid()) {
    Object targetNodeId;
    String fieldValue=extractNodeForm.getFieldValue(TARGET_NODE_ID_KEY);
    if (fieldValue != null && !(fieldValue.isEmpty())) {
      targetNodeId=fieldValue;
    }
 else {
      targetNodeId=getNodeId();
    }
    Command findNode=Services.command(FindNodeCommand.class);
    final AbstractNode targetNode=(AbstractNode)findNode.execute(user,targetNodeId);
    final Command transactionCommand=Services.command(TransactionCommand.class);
    transactionCommand.execute(new StructrTransaction(){
      @Override public Object execute() throws Throwable {
        Command extractFile=Services.command(ExtractFileCommand.class);
        extractFile.execute(getNodeId(),targetNode,user);
        transactionCommand.setExitCode(extractFile.getExitCode());
        transactionCommand.setErrorMessage(extractFile.getErrorMessage());
        return null;
      }
    }
);
    Map<String,String> parameters=new HashMap<String,String>();
    parameters.put(NODE_ID_KEY,String.valueOf(getNodeId()));
    parameters.put(RENDER_MODE_KEY,renderMode);
    if (transactionCommand.getExitCode().equals(Command.exitCode.FAILURE)) {
      errorMsg=transactionCommand.getErrorMessage();
      Services.command(AddNotificationCommand.class).execute(new ErrorNotification(errorMsg));
      parameters.put(ERROR_MSG_KEY,errorMsg);
    }
 else {
      okMsg="Node extracted to " + targetNodeId;
      Services.command(AddNotificationCommand.class).execute(new SuccessNotification(okMsg));
      parameters.put(OK_MSG_KEY,okMsg);
    }
    setRedirect(getRedirectPage(node),parameters);
  }
  if (!extractNodeForm.isValid()) {
    extractNodeFormIsInvalid="true";
    return true;
  }
  return false;
}
