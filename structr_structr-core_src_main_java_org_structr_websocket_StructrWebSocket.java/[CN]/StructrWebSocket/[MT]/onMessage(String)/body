{
  WebSocketData webSocketData=gson.fromJson(data,WebSocketData.class);
  try {
    String command=webSocketData.getCommand();
    Class type=commandSet.get(command);
    if (type != null) {
      AbstractMessage message=(AbstractMessage)type.newInstance();
      message.setConnection(connection);
      message.setIdProperty(idProperty);
      if (message.processMessage(webSocketData)) {
        broadcast(gson.toJson(webSocketData,WebSocketData.class));
      }
 else {
      }
    }
 else {
      logger.log(Level.WARNING,"Unknow command {0}",command);
    }
  }
 catch (  Throwable t) {
    logger.log(Level.WARNING,"Unable to parse message.",t);
  }
}
