{
  HttpSession session=SessionContext.getSession();
  Integer retries=getLoginAttemptsValue().get();
  if (retries != null && retries > maxRetries) {
    logger.log(Level.SEVERE,"More than {0} login failures, session {1} is blocked",new Object[]{maxRetries,session.getId()});
    getSessionBlockedValue().set(true);
    getErrorMessageValue().set("Too many unsuccessful login attempts, your session is blocked for login!");
  }
 else   if (retries != null && retries > delayThreshold) {
    logger.log(Level.INFO,"More than {0} login failures, execution delayed by {1} seconds",new Object[]{maxRetries,delayTime});
    try {
      Thread.sleep(delayTime * 1000);
    }
 catch (    InterruptedException ex) {
      logger.log(Level.SEVERE,null,ex);
    }
    StringBuilder errorBuffer=new StringBuilder(200);
    errorBuffer.append("You had more than ");
    errorBuffer.append(maxRetries);
    errorBuffer.append(" unsuccessful login attempts, execution was delayed by ");
    errorBuffer.append(delayTime);
    errorBuffer.append(" seconds.");
    getErrorMessageValue().set(errorBuffer.toString());
  }
 else   if (retries != null) {
    getLoginAttemptsValue().set(getLoginAttemptsValue().get() + 1);
  }
 else {
    getLoginAttemptsValue().set(1);
  }
}
