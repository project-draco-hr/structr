{
  String valuePropertyName=currentNode.getStringProperty(AbstractPieChart.Key.valueProperty);
  DefaultPieDataset dataSet=new DefaultPieDataset();
  boolean recursive=currentNode.getRecursive();
  int width=currentNode.getWidth();
  int height=currentNode.getHeight();
  for (  StructrRelationship rel : currentNode.getOutgoingDataRelationships()) {
    AbstractNode endNode=rel.getEndNode();
    for (    AbstractNode child : endNode.getDirectChildNodes()) {
      collectData(valuePropertyName,child,dataSet,recursive);
    }
  }
  PiePlot plot=currentNode.getPiePlot(dataSet);
  plot.setBackgroundPaint(Color.WHITE);
  JFreeChart chart=new JFreeChart(plot);
  chart.setBorderVisible(false);
  chart.setBackgroundPaint(Color.WHITE);
  writeImage(out,chart.createBufferedImage(width,height));
}
