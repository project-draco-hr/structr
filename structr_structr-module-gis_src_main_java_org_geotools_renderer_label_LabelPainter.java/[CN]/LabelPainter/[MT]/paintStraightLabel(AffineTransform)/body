{
  AffineTransform oldTransform=graphics.getTransform();
  try {
    AffineTransform newTransform=new AffineTransform(oldTransform);
    newTransform.concatenate(transform);
    graphics.setTransform(newTransform);
    Style2D graphic=labelItem.getTextStyle().getGraphic();
    if (graphic != null) {
      double offsetY=0;
      double offsetX=0;
      final int[] margin=labelItem.getGraphicMargin();
      if (margin != null) {
        offsetX=margin[1] - margin[3];
        offsetY=margin[2] - margin[0];
      }
      MetaDataShape tempShape=new MetaDataShape(gf.createPoint(new Coordinate(labelBounds.getWidth() / 2.0 + offsetX,-1.0 * labelBounds.getHeight() / 2.0 + offsetY)),null,null,false,false);
      graphic=resizeGraphic(graphic);
      shapePainter.paint(graphics,tempShape,graphic,graphic.getMaxScale());
    }
    if (labelItem.getTextStyle().getFont().getSize() == 0)     return;
    if (lines.size() == 1) {
      drawGlyphVector(lines.get(0).gv);
    }
 else {
      AffineTransform lineTx=new AffineTransform(transform);
      for (      LineInfo line : lines) {
        lineTx.setTransform(transform);
        lineTx.translate(line.x,line.y);
        graphics.setTransform(lineTx);
        drawGlyphVector(line.gv);
      }
    }
  }
  finally {
    graphics.setTransform(oldTransform);
  }
}
