{
  for (int i=0; i < geometries.size(); i++) {
    if (geometries.get(i) == originalGeom) {
      return (MetaDataShape)shapes.get(i);
    }
  }
  Geometry geom=originalGeom;
  if (clone || !(geom.getFactory().getCoordinateSequenceFactory() instanceof LiteCoordinateSequenceFactory)) {
    geom=LiteCoordinateSequence.cloneGeometry(geom);
  }
  MetaDataShape shape;
  if (projectionHandler != null && sa != null) {
    geom=projectionHandler.preProcess(sa.crs,geom);
    if (geom == null) {
      shape=null;
    }
 else {
      Decimator d=getDecimator(sa.xform);
      d.decimateTransformGeneralize(geom,sa.crsxform);
      geom.geometryChanged();
      geom=projectionHandler.postProcess(geom);
      if (geom == null) {
        shape=null;
      }
 else {
        d=new Decimator(-1,-1);
        d.decimateTransformGeneralize(geom,sa.axform);
        geom.geometryChanged();
        shape=new MetaDataShape(geom,null,null,false,false);
      }
    }
  }
 else {
    MathTransform2D xform=null;
    if (sa != null) {
      xform=sa.xform;
    }
    shape=new MetaDataShape(geom,xform,getDecimator(xform),false,false);
  }
  geometries.add(originalGeom);
  shapes.add(shape);
  return shape;
}
