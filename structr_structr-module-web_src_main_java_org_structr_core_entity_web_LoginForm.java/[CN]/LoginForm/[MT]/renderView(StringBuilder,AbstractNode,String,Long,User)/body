{
  if (editNodeId != null && getId() == editNodeId.longValue()) {
    renderEditFrame(out,editUrl);
  }
 else {
    HttpServletRequest request=StructrContext.getRequest();
    if (request == null) {
      return;
    }
    HttpSession session=request.getSession();
    if (session == null) {
      return;
    }
    String usernameFromSession=(String)session.getAttribute(USERNAME_KEY);
    Boolean alreadyLoggedIn=usernameFromSession != null;
    if (alreadyLoggedIn) {
      out.append("<div class=\"okMsg\">").append("Your are logged in as ").append(usernameFromSession).append("</div>");
      return;
    }
    Boolean sessionBlocked=(Boolean)session.getAttribute(SESSION_BLOCKED);
    if (Boolean.TRUE.equals(sessionBlocked)) {
      out.append("<div class=\"errorMsg\">").append("Too many login attempts, session is blocked for login").append("</div>");
      return;
    }
    String action=getAction() != null ? getAction() : defaultAction;
    String submitButtonName=getSubmitButtonName() != null ? getSubmitButtonName() : defaultSubmitButtonName;
    String antiRobotFieldName=getAntiRobotFieldName() != null ? getAntiRobotFieldName() : defaultAntiRobotFieldName;
    String usernameFieldName=getUsernameFieldName() != null ? getUsernameFieldName() : defaultUsernameFieldName;
    String passwordFieldName=getPasswordFieldName() != null ? getPasswordFieldName() : defaultPasswordFieldName;
    String cssClass=getCssClass() != null ? getCssClass() : defaultCssClass;
    String label=getLabel() != null ? getLabel() : defaultLabel;
    String username=StringUtils.trimToEmpty(param(usernameFieldName));
    String password=StringUtils.trimToEmpty(param(passwordFieldName));
    out.append("<form name=\"").append(getName()).append("\" action=\"").append(action).append("\" method=\"post\">");
    out.append("<input type=\"hidden\" name=\"").append(antiRobotFieldName).append("\" value=\"\">");
    out.append("<table class=\"").append(cssClass).append("\">");
    out.append("<tr><th><span class=\"heading\">").append(label).append("</span></th><th></th></tr>");
    out.append("<tr><td class=\"label\">Username</td></tr>");
    out.append("<tr><td class=\"field\"><input type=\"text\" name=\"").append(usernameFieldName).append("\" value=\"").append(username).append("\" size=\"30\"></td></tr>");
    out.append("<tr><td class=\"label\">Password</td></tr>");
    out.append("<tr><td class=\"field\"><input type=\"password\" name=\"").append(passwordFieldName).append("\" value=\"").append(password).append("\" size=\"30\"></td></tr>");
    out.append("<tr><td class=\"button\"><input type=\"submit\" name=\"").append(submitButtonName).append("\" value=\"Submit\"></td></tr>");
    out.append("</table>");
    out.append("</form>");
  }
}
