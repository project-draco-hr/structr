{
  final List<GraphObject> relationResults=new LinkedList<GraphObject>();
  if (wrappedResource != null) {
    final List<? extends GraphObject> results=wrappedResource.doGet(sortKey,sortDescending,pageSize,page,offsetId).getResults();
    for (    final GraphObject obj : results) {
      if (obj instanceof AbstractNode) {
        relationResults.addAll(namedRelation.getRelationships(obj));
      }
    }
  }
 else {
    final List<SearchAttribute> searchAttributes=new LinkedList<SearchAttribute>();
    searchAttributes.add(Search.andExactRelType(namedRelation));
    searchAttributes.addAll(extractSearchableAttributesForRelationships(namedRelation.getEntityClass().getSimpleName(),request));
    relationResults.addAll((List<AbstractRelationship>)Services.command(securityContext,SearchRelationshipCommand.class).execute(searchAttributes));
  }
  final List<SearchAttribute> filterAttributes=extractSearchableAttributesForRelationships(namedRelation.getEntityClass().getSimpleName(),request);
  if (!filterAttributes.isEmpty()) {
    final Predicate<GraphObject> predicate=new Predicate<GraphObject>(){
      @Override public boolean evaluate(      final SecurityContext securityContext,      final GraphObject... objs){
        if (objs.length > 0) {
          final GraphObject obj=objs[0];
          for (          final SearchAttribute attr : filterAttributes) {
            final String value=((TextualSearchAttribute)attr).getValue();
            final PropertyKey key=((TextualSearchAttribute)attr).getKey();
            final Object val="\"" + obj.getProperty(key) + "\"";
            if (val != null && val.equals(value)) {
              return true;
            }
          }
        }
        return false;
      }
    }
;
    for (final Iterator<GraphObject> it=relationResults.iterator(); it.hasNext(); ) {
      if (!predicate.evaluate(securityContext,it.next())) {
        it.remove();
      }
    }
  }
  return new Result(relationResults,null,isCollectionResource(),isPrimitiveArray());
}
