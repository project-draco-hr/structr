{
  logger.log(Level.FINE,"Adding id {0} to id set",typedIdResource.getIdResource().getUriPart());
  IdResource idResource=typedIdResource.getIdResource();
  if (idResource instanceof UuidResource) {
    if (!idSet.add(((UuidResource)idResource).getUriPart())) {
      throw new IllegalPathException();
    }
  }
 else {
    if (!idSet.add(idResource.getId())) {
      throw new IllegalPathException();
    }
  }
  uriParts.add(typedIdResource.getUriPart());
  DirectedRelationship rel=findDirectedRelationship(lastResource,typedIdResource);
  if (rel != null) {
    if (!visitedRelationships.contains(rel)) {
      traversalDescription=traversalDescription.relationships(rel.getRelType(),rel.getDirection());
      visitedRelationships.add(rel);
    }
  }
 else {
    String rawType1=lastResource.getTypeResource().getRawType();
    String rawType2=typedIdResource.getTypeResource().getRawType();
    logger.log(Level.INFO,"No relationship defined between {0} and {1}, illegal path",new Object[]{rawType1,rawType2});
    throw new IllegalPathException();
  }
  lastResource=typedIdResource;
}
