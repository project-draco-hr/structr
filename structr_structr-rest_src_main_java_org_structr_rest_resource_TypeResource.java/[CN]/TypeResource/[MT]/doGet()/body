{
  List<SearchAttribute> searchAttributes=new LinkedList<SearchAttribute>();
  AbstractNode topNode=null;
  boolean includeDeleted=false;
  boolean publicOnly=false;
  if (rawType != null) {
    if (entityClass == null) {
      throw new NotFoundException();
    }
    DistanceSearchAttribute distanceSearch=getDistanceSearch(request);
    if (distanceSearch != null) {
      searchAttributes.add(distanceSearch);
      searchAttributes.add(new FilterSearchAttribute(AbstractNode.Key.type.name(),EntityContext.normalizeEntityName(rawType),SearchOperator.AND));
    }
 else {
      searchAttributes.addAll(Search.andExactTypeAndSubtypes(EntityContext.normalizeEntityName(rawType)));
      hasSearchableAttributesForNodes(rawType,request,searchAttributes);
    }
    List<GraphObject> results=(List<GraphObject>)Services.command(securityContext,SearchNodeCommand.class).execute(topNode,includeDeleted,publicOnly,searchAttributes);
    if (!results.isEmpty()) {
      if (distanceSearch == null) {
        applyDefaultSorting(results);
      }
      return results;
    }
  }
 else {
    logger.log(Level.WARNING,"type was null");
  }
  return Collections.emptyList();
}
