{
  try {
    request.setCharacterEncoding("UTF-8");
    response.setCharacterEncoding("UTF-8");
    response.setContentType("application/json; charset=UTF-8");
    final JsonInput propertySet=gson.fromJson(request.getReader(),JsonInput.class);
    SecurityContext securityContext=getSecurityContext(request,response);
    if (securityContext != null) {
      List<Resource> chain=ResourceHelper.parsePath(securityContext,request,resourceMap,propertyView,defaultIdProperty);
      Resource resourceConstraint=ResourceHelper.optimizeConstraintChain(chain,defaultIdProperty);
      Map<String,Object> properties=convertPropertySetToMap(propertySet);
      securityContext.examineRequest(request,resourceConstraint.getResourceSignature(),resourceConstraint.getGrant(),propertyView.get(securityContext));
      RestMethodResult result=resourceConstraint.doPost(properties);
      propertyView.set(securityContext,defaultPropertyView);
      result.commitResponse(gson,response);
    }
 else {
      RestMethodResult result=new RestMethodResult(HttpServletResponse.SC_FORBIDDEN);
      result.commitResponse(gson,response);
    }
  }
 catch (  FrameworkException frameworkException) {
    response.setStatus(frameworkException.getStatus());
    gson.toJson(frameworkException,response.getWriter());
    response.getWriter().println();
    response.getWriter().flush();
    response.getWriter().close();
  }
catch (  JsonSyntaxException jsex) {
    logger.log(Level.WARNING,"JsonSyntaxException in POST",jsex);
    int code=HttpServletResponse.SC_BAD_REQUEST;
    response.setStatus(code);
    response.getWriter().append(jsonError(code,"JsonSyntaxException in POST: " + jsex.getMessage()));
  }
catch (  JsonParseException jpex) {
    logger.log(Level.WARNING,"JsonParseException in POST",jpex);
    int code=HttpServletResponse.SC_BAD_REQUEST;
    response.setStatus(code);
    response.getWriter().append(jsonError(code,"JsonParseException in POST: " + jpex.getMessage()));
  }
catch (  UnsupportedOperationException uoe) {
    logger.log(Level.WARNING,"POST not supported",uoe);
    int code=HttpServletResponse.SC_BAD_REQUEST;
    response.setStatus(code);
    response.getWriter().append(jsonError(code,"POST not supported: " + uoe.getMessage()));
  }
catch (  Throwable t) {
    logger.log(Level.WARNING,"Exception in POST",t);
    int code=HttpServletResponse.SC_INTERNAL_SERVER_ERROR;
    response.setStatus(code);
    response.getWriter().append(jsonError(code,"JsonSyntaxException in POST: " + t.getMessage()));
  }
}
