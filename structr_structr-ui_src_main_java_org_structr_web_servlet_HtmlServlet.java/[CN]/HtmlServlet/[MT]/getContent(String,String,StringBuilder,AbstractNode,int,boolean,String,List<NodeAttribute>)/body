{
  String localComponentId=componentId;
  String content=null;
  String tag=null;
  AbstractRelationship link=null;
  if (node != null) {
    String structrClass=node.getStringProperty(Component.UiKey.structrclass);
    if (structrClass != null && structrClass.equals(EntityContext.normalizeEntityName(searchClass)) && attrs != null) {
      for (      NodeAttribute attr : attrs) {
        String key=attr.getKey();
        Object val=attr.getValue();
        if (!val.equals(node.getProperty(key))) {
          return;
        }
      }
    }
    String id=node.getStringProperty("uuid");
    for (int d=0; d < depth; d++) {
      System.out.print(" ");
    }
    if (node instanceof Content) {
      content=node.getStringProperty("content");
      List<AbstractRelationship> links=node.getOutgoingLinkRelationships();
      if ((links != null) && !links.isEmpty()) {
        link=links.get(0);
      }
    }
    if (node instanceof Component) {
      localComponentId=node.getStringProperty(AbstractNode.Key.uuid);
    }
    if (link != null) {
      buffer.append("<a href=\"").append(link.getEndNode().getName()).append("\">");
    }
    tag=node.getStringProperty("tag");
    if (edit && inBody && (node instanceof Content)) {
      buffer.delete(buffer.length() - 1,buffer.length());
      buffer.append(" structr_content_id=\"").append(id).append("\">");
    }
    if (StringUtils.isNotBlank(tag)) {
      if (tag.equals("body")) {
        inBody=true;
      }
      buffer.append("<").append(tag);
      if (edit && (id != null)) {
        if (depth == 1) {
          buffer.append(" structr_resource_id='").append(resourceId).append("'");
        }
        if (node instanceof Content) {
        }
 else {
          String htmlClass=node.getStringProperty("_html_class");
          buffer.append(" class=\"structr-element-container ").append((htmlClass != null) ? htmlClass : "").append("\" structr_element_id='").append(id).append("'");
          buffer.append(" structr_type='").append(node.getType()).append("'");
          buffer.append(" structr_name='").append(node.getName()).append("'");
        }
      }
      if (node instanceof HtmlElement) {
        for (        String attribute : EntityContext.getPropertySet(node.getClass(),PropertyView.Html)) {
          if (StringUtils.isNotBlank(node.getStringProperty(attribute))) {
            String key=attribute.substring(PropertyView.Html.length());
            buffer.append(" ").append(key).append("=\"").append(node.getProperty(attribute)).append("\"");
          }
        }
      }
      buffer.append(">");
    }
    if (content != null) {
      buffer.append(content);
    }
  }
  List<AbstractRelationship> rels=new LinkedList<AbstractRelationship>();
  for (  AbstractRelationship abstractRelationship : node.getOutgoingRelationships(RelType.CONTAINS)) {
    Relationship rel=abstractRelationship.getRelationship();
    if (rel.hasProperty(resourceId) || rel.hasProperty("*")) {
      AbstractNode endNode=abstractRelationship.getEndNode();
      if ((localComponentId != null) && ((endNode instanceof Content) || (endNode instanceof Component))) {
        if (rel.hasProperty(localComponentId)) {
          rels.add(abstractRelationship);
        }
      }
 else {
        rels.add(abstractRelationship);
      }
    }
  }
  Collections.sort(rels,new Comparator<AbstractRelationship>(){
    @Override public int compare(    AbstractRelationship o1,    AbstractRelationship o2){
      Integer pos1=getPosition(o1,resourceId);
      Integer pos2=getPosition(o2,resourceId);
      return pos1.compareTo(pos2);
    }
  }
);
  for (  AbstractRelationship rel : rels) {
    AbstractNode subNode=rel.getEndNode();
    getContent(resourceId,localComponentId,buffer,subNode,depth + 1,inBody,searchClass,attrs);
  }
  if (StringUtils.isNotBlank(tag) && !(ArrayUtils.contains(html5VoidTags,tag))) {
    buffer.append("</").append(tag).append(">");
  }
  if (link != null) {
    buffer.append("</a>");
  }
}
