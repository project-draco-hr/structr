{
  final SecurityContext securityContext=getWebSocket().getSecurityContext();
  String nodeId=webSocketData.getId();
  final AbstractNode nodeToClone=getNode(nodeId);
  if (nodeToClone != null) {
    StructrTransaction transaction=new StructrTransaction(){
      @Override public Object execute() throws FrameworkException {
        Resource newResource=(Resource)Services.command(securityContext,CreateNodeCommand.class).execute(new NodeAttribute(AbstractNode.Key.type.name(),Resource.class.getSimpleName()));
        if (newResource != null) {
          String resourceId=newResource.getStringProperty(AbstractNode.Key.uuid);
          Html htmlNode=null;
          List<AbstractRelationship> relsOut=nodeToClone.getOutgoingRelationships(RelType.CONTAINS);
          for (          AbstractRelationship out : relsOut) {
            AbstractNode endNode=out.getEndNode();
            if (endNode.getType().equals(Html.class.getSimpleName())) {
              htmlNode=(Html)endNode;
            }
          }
          if (htmlNode != null) {
            RelationClass rel=EntityContext.getRelationClass(newResource.getClass(),htmlNode.getClass());
            if (rel != null) {
              Map<String,Object> relProps=new LinkedHashMap<String,Object>();
              relProps.put(resourceId,0);
              relProps.put("resourceId",resourceId);
              try {
                rel.createRelationship(securityContext,newResource,htmlNode,relProps);
              }
 catch (              Throwable t) {
                getWebSocket().send(MessageBuilder.status().code(400).message(t.getMessage()).build(),true);
              }
              tagOutgoingRelsWithResourceId(newResource,newResource,resourceId);
            }
          }
        }
 else {
          getWebSocket().send(MessageBuilder.status().code(404).build(),true);
        }
        return null;
      }
    }
;
    try {
      Services.command(securityContext,TransactionCommand.class).execute(transaction);
    }
 catch (    FrameworkException fex) {
      logger.log(Level.WARNING,"Could not create node.",fex);
      getWebSocket().send(MessageBuilder.status().code(fex.getStatus()).message(fex.getMessage()).build(),true);
    }
  }
 else {
    logger.log(Level.WARNING,"Node with uuid {0} not found.",webSocketData.getId());
    getWebSocket().send(MessageBuilder.status().code(404).build(),true);
  }
}
