{
  final SecurityContext securityContext=getWebSocket().getSecurityContext();
  createNode=Services.command(securityContext,CreateNodeCommand.class);
  createRel=Services.command(securityContext,CreateRelationshipCommand.class);
  StructrTransaction transaction=new StructrTransaction(){
    @Override public Object execute() throws FrameworkException {
      Map<String,Object> nodeData=webSocketData.getNodeData();
      nodeData.put(AbstractNode.Key.visibleToAuthenticatedUsers.name(),true);
      nodeData.put(AbstractNode.Key.type.name(),Page.class.getSimpleName());
      AbstractNode page=(AbstractNode)createNode.execute(nodeData);
      page.setProperty(Page.UiKey.contentType,"text/html");
      Html html=(Html)createElement(nodeData,page,Html.class.getSimpleName(),0,page);
      Head head=(Head)createElement(nodeData,page,Head.class.getSimpleName(),0,html);
      Body body=(Body)createElement(nodeData,page,Body.class.getSimpleName(),1,html);
      Title title=(Title)createElement(nodeData,page,Title.class.getSimpleName(),0,head);
      Content content=(Content)createElement(nodeData,page,Content.class.getSimpleName(),0,title);
      content.setProperty(Content.UiKey.content,"Page Title");
      H1 h1=(H1)createElement(nodeData,page,H1.class.getSimpleName(),0,body);
      Content h1Content=(Content)createElement(nodeData,page,Content.class.getSimpleName(),0,h1);
      h1Content.setProperty(Content.UiKey.content,"Page Title");
      Div div=(Div)createElement(nodeData,page,Div.class.getSimpleName(),1,body);
      Content divContent=(Content)createElement(nodeData,page,Content.class.getSimpleName(),0,div);
      divContent.setProperty(Content.UiKey.content,"Body Text");
      return page;
    }
  }
;
  try {
    Services.command(securityContext,TransactionCommand.class).execute(transaction);
  }
 catch (  FrameworkException fex) {
    logger.log(Level.WARNING,"Could not create node.",fex);
    getWebSocket().send(MessageBuilder.status().code(fex.getStatus()).message(fex.getMessage()).build(),true);
  }
}
